<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Auto Cropper</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <link href="./css/common.css" rel="stylesheet" />
        <link href="./subproject/css/product_detail.css" rel="stylesheet" />

        <script src="http://sdk.amazonaws.com/js/aws-sdk-2.1.24.min.js"></script>

        <!-- 공통 -->
        <script type="text/javascript" src="./js/common.js"></script>

        <!-- 셀렉트박스 모듈 -->
        <!-- <script type="text/javascript" src="./js/selectbox_core_module.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/selectbox.css" /> -->

        <!-- 테이블 모듈 -->
        <script type="text/javascript" src="./js/table_core_module.js"></script>
        <link href="./css/table.css" rel="stylesheet" />

        <!-- 팝업 모듈 -->
        <script type="text/javascript" src="./js/popup_core_module.js"></script>

        <script>
            window.onload = function() {
                const host = window.location.host;

                common.menu();
                common.expander();
                
                // 아이디를 통해 크리에이터 정보 조회
                const id = window.location.search.substring(1).split("=")[1];
                
                // 데이터 획득
                function fetch(id) {
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function(e) {
                        if (xhr.readyState == 4) {
                            if (xhr.status == 200) {
                                const result = JSON.parse(xhr.responseText);
                                const data = result.result;
                                console.log(data);
                                parsing(data);
                            } else {
                                console.log("xhr error");
                            }
                        }
                    }
                    xhr.open("GET", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/product/" + id, true);
                    xhr.send();
                }
                fetch(id);

                // 데이터 파싱[+ UI생성]
                function parsing(data) {
                    document.querySelector("#product-thumbnail").style.backgroundImage = "url('" + data.productImagePath + "')";
                    document.querySelector("#product-name").innerText = data.name;
                    document.querySelector("#product-creator").innerText = data.creatorName;
                    document.querySelector("#product-package-creator").innerHTML = data.packageCreatorName;
                    document.querySelector("#product-cost").innerText = data.productPrice.cost + "원";
                    document.querySelector("#product-price").innerHTML = data.productPrice.price + "원";

                    const option_list = document.querySelector("#option-list");
                    option_list.innerHTML = "";

                    const options = data.productOptions;
                    for(option of options) {
                        let img = option.imagePath + option.mockupImage;
                        if(host === "127.0.0.1:5500" 
                                || host === "localhost:5500" 
                                || host === "192.167.0.177:5500") {
                                    img = "/cropper/src" + img;
                        }

                        const download_btn = document.createElement("div");
                        download_btn.innerText = "DOWNLOAD";
                        download_btn.setAttribute("data-url", img);
                        download_btn.style.position = "absolute";
                        download_btn.style.bottom = "0px";
                        download_btn.style.right = "0px";
                        download_btn.style.width = "100px";
                        download_btn.style.minHeight = "20px";
                        download_btn.style.backgroundColor = "#4286f4";
                        download_btn.style.color = "#FFFFFF";
                        download_btn.style.borderTop = "1px solid #e2e2e2";
                        download_btn.style.borderLeft = "1px solid #e2e2e2";
                        download_btn.style.display = "flex";
                        download_btn.style.justifyContent = "center";
                        download_btn.style.alignItems = "center";
                        download_btn.style.cursor = "pointer";
                        download_btn.addEventListener("click", function(e) {
                            e.preventDefault();
                            // 파일 다운로드 구현
                            const url = this.getAttribute("data-url");
                            var link = document.createElement('a');
                            link.style.width = "0px";
                            link.style.height = "0px";
                            link.style.visibility = "hidden";
                            link.href = url;
                            link.download = 'product_image.png';
                            this.appendChild(link);
                            link.click();
                            this.removeChild(link);
                        });

                        const option_item_div = document.createElement("div");
                        option_item_div.id = "option-item";
                        option_item_div.style.position = "relative";
                        option_item_div.style.backgroundImage = "url('" + img + "')";
                        option_item_div.style.backgroundPosition = "center";
                        option_item_div.style.backgroundSize = "cover";
                        option_item_div.classList.add("option-item");
                        option_item_div.appendChild(download_btn);
                        option_list.appendChild(option_item_div);
                    }
                }
            }
        </script>
    </head>
    <body class="ac">
        <div class="wrapper">
            <div class="content">
                <div class="info">
                    <div class="product">
                        <div id="product-thumbnail" class="thumbnail"></div>
                        <div id="product-name" class="name"></div>
                        <div id="product-creator" class="creator"></div>
                        <div id="product-package-creator" class="creator"></div>
                    </div>
                    <div class="price">
                        <div id="product-cost"></div>
                        <div id="product-price"></div>
                    </div>
                    <div id="price-update-btn" class="price-update-btn">가격 수정</div>
                </div>
                <div class="data">
                    <div id="option-list" class="option-list">
                    </div>
                </div>
            </div>
            <div class="nav reduction">
                <div class="nav-head">
                    <div class="nav-head-expander">
                        <i class="material-icons">
                            first_page
                        </i>
                    </div>
                    <div class="nav-head-logo">
                        Auto Cropper
                    </div>
                </div>
                <div class="nav-body">
                    <div class="nav-body-menu">
                        <div class="menu-item" data-page="edit">
                            <i class="material-icons">
                                crop_free
                            </i>
                            edit
                        </div>
                        <div class="menu-item" data-page="auto">
                            <i class="material-icons">
                                style
                            </i>
                            auto
                        </div>
                        <div class="menu-item" data-page="creator">
                            <i class="material-icons">
                                people
                            </i>
                            creator
                        </div>
                        <div class="menu-item" data-page="maker">
                            <i class="material-icons">
                                build
                            </i>
                            maker
                        </div>
                        <div class="menu-item" data-page="package">
                            <i class="material-icons">
                                how_to_vote
                            </i>
                            package
                        </div>
                        <div class="menu-item active" data-page="product">
                            <i class="material-icons">
                                local_mall
                            </i>
                            product
                        </div>
                    </div>
                    <div class="nav-body-content">
                        
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>