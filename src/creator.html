<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Auto Cropper</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <link href="./css/common.css" rel="stylesheet" />
        <link href="./subproject/css/creator.css" rel="stylesheet" />

        <!-- 공통 -->
        <script type="text/javascript" src="./js/common.js"></script>

        <!-- 오토크로퍼 모듈 -->
        <script type="text/javascript" src="./js/cropper_core_module.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/cropper.css" />

        <!-- 셀렉트박스 모듈 -->
        <script type="text/javascript" src="./js/selectbox_core_module.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/selectbox.css" />

        <!-- 테이블 모듈 -->
        <script type="text/javascript" src="./js/table_core_module.js"></script>
        <link href="./css/table.css" rel="stylesheet" />

        <!-- 팝업 모듈 -->
        <script type="text/javascript" src="./js/popup_core_module.js"></script>

        <script>
            window.onload = function() {
                common.menu();
                common.expander();
                
                // const table = new Table("data/creator.json");
                const table = new Table("http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/productCreators");
                table.body("page=0", bodydata);

                // 테이블 바디설정 태그
                function bodydata(item, target) {
                    // DIV ROW 생성
                    const row = document.createElement("div");
                    row.classList.add("ac-table-row");

                    // DIV COLUM 생성, 데이터를 어떻게 파싱할지
                    const column_01 = document.createElement("div");
                    column_01.id = "ac-creator-number";
                    column_01.style.width = "80px";
                    column_01.innerText = item.id;
                    column_01.classList.add("ac-table-column");
                    
                    const column_02 = document.createElement("div");
                    column_02.id = "ac-creator-id";
                    column_02.style.width = "150px";
                    column_02.innerText = item.userId;
                    column_02.classList.add("ac-table-column");

                    const column_03 = document.createElement("div");
                    column_03.id = "ac-creator-name";
                    column_03.style.width = "150px";
                    column_03.innerText = item.creatorName;
                    column_03.classList.add("ac-table-column");

                    const btn_detail = document.createElement("div");
                    btn_detail.id = "ac-btn-detail";
                    btn_detail.setAttribute("data-id", item.id);
                    btn_detail.innerText = "상세";
                    btn_detail.classList.add("ac-table-btn-detail");
                    btn_detail.addEventListener("click", function(e) {
                        e.preventDefault();
                        window.location.href = "creator_detail.html?id=" + this.getAttribute("data-id");
                    });

                    const column_04 = document.createElement("div");
                    column_04.id = "ac-creator-setting";
                    column_04.style.width = "150px";
                    column_04.classList.add("ac-table-column");
                    column_04.appendChild(btn_detail);

                    row.appendChild(column_01);
                    row.appendChild(column_02);
                    row.appendChild(column_03);
                    row.appendChild(column_04);

                    target.appendChild(row);
                }

                const popup_reg = new Popup();
                // 실제 팝업창에 그려질 form 문 작성
                popup_reg.init(function(popup) {
                    const form = document.createElement("form");
                    form.id = "creator-regist";
                    form.style.display = "flex";
                    form.style.flexDirection = "column";
                    form.style.margin = "30px";
                    form.style.justifyContent = "center";
                    form.style.alignItems = "center";

                    // 타이틀
                    const title_div = document.createElement("div");
                    title_div.innerText = "크리에이터 등록"
                    title_div.style.fontSize = "20px";
                    title_div.style.fontWeight = "bold";
                    title_div.style.color = "#4286f4";

                    // 이름
                    const name_div = document.createElement("div");
                    const name_label = document.createElement("div");
                    name_label.innerText = "이름 : ";
                    name_label.style.width = "100px";
                    name_label.style.fontWeight = "bold";
                    const name = document.createElement("input");
                    name.id = "creator-name";
                    name.style.padding = "5px";
                    name.style.fontSize = "15px";
                    name.setAttribute("name", "creatorName");
                    name_div.style.marginTop = "20px";
                    // name_div.style.width = "300px";
                    name_div.appendChild(name_label);
                    name_div.appendChild(name);

                    // 계정
                    const id_div = document.createElement("div");
                    const id_label = document.createElement("div");
                    id_label.innerText = "아이디 : ";
                    id_label.style.width = "100px";
                    id_label.style.fontWeight = "bold";
                    const id = document.createElement("input");
                    id.id = "user-id";
                    id.style.padding = "5px";
                    id.style.fontSize = "15px";
                    id.setAttribute("name", "userId");
                    id_div.style.marginTop = "20px";
                    // id_div.style.width = "300px";
                    id_div.appendChild(id_label);
                    id_div.appendChild(id);

                    // 계좌 번호
                    const account_no_div = document.createElement("div");
                    const account_no_label = document.createElement("div");
                    account_no_label.innerText = "계좌번호 : ";
                    account_no_label.style.width = "100px";
                    account_no_label.style.fontWeight = "bold";
                    const account_no = document.createElement("input");
                    account_no.id = "account-no";
                    account_no.style.padding = "5px";
                    account_no.style.fontSize = "15px";
                    account_no.setAttribute("name", "accountNo");
                    account_no_div.style.marginTop = "20px";
                    // account_no_div.style.width = "300px";
                    account_no_div.appendChild(account_no_label);
                    account_no_div.appendChild(account_no);

                    // 은행 코드
                    const bank_code_div = document.createElement("div");
                    const bank_code_label = document.createElement("div");
                    bank_code_label.innerText = "은행코드 : ";
                    bank_code_label.style.width = "100px";
                    bank_code_label.style.fontWeight = "bold";
                    const bank_code = document.createElement("input");
                    bank_code.id = "bank-code";
                    bank_code.style.padding = "5px";
                    bank_code.style.fontSize = "15px";
                    bank_code.setAttribute("name", "bankCode");
                    bank_code.value = "1111";
                    bank_code_div.style.marginTop = "20px";
                    // bank_code_div.style.width = "300px";
                    bank_code_div.appendChild(bank_code_label);
                    bank_code_div.appendChild(bank_code);

                    // 은행 이름
                    const bank_name_div = document.createElement("div");
                    const bank_name_label = document.createElement("div");
                    bank_name_label.innerText = "은행이름 : ";
                    bank_name_label.style.width = "100px";
                    bank_name_label.style.fontWeight = "bold";
                    const bank_name = document.createElement("input");
                    bank_name.id = "bank-name";
                    bank_name.style.padding = "5px";
                    bank_name.style.fontSize = "15px";
                    bank_name.setAttribute("name", "bankName");
                    bank_name_div.style.marginTop = "20px";
                    // bank_name_div.style.width = "300px";
                    bank_name_div.appendChild(bank_name_label);
                    bank_name_div.appendChild(bank_name);

                    // 계좌주 이름
                    const owner_name_div = document.createElement("div");
                    const owner_name_label = document.createElement("div");
                    owner_name_label.innerText = "계좌주 : ";
                    owner_name_label.style.width = "100px";
                    owner_name_label.style.fontWeight = "bold";
                    const owner_name = document.createElement("input");
                    owner_name.id = "owner-name";
                    owner_name.style.padding = "5px";
                    owner_name.style.fontSize = "15px";
                    owner_name.setAttribute("name", "ownerName");
                    owner_name_div.style.marginTop = "20px";
                    // owner_name_div.style.width = "300px";
                    owner_name_div.appendChild(owner_name_label);
                    owner_name_div.appendChild(owner_name);

                    // 버튼
                    const submit_btn = document.createElement("div");
                    submit_btn.innerText = "등록";
                    submit_btn.style.width = "100px";
                    submit_btn.style.height = "40px";
                    submit_btn.style.marginTop = "20px";
                    submit_btn.style.backgroundColor = "#FFFFFF";
                    submit_btn.style.border = "1px solid #e2e2e2";
                    submit_btn.style.display = "flex";
                    submit_btn.style.justifyContent = "center";
                    submit_btn.style.alignItems = "center";
                    submit_btn.style.cursor = "pointer";
                    submit_btn.addEventListener("click", function(e) {
                        e.preventDefault();
                        console.log(e);
                        // 하나씩 파싱해서 데이터 저장
                        const creator_name = document.querySelector("#creator-name").value;
                        const user_id = document.querySelector("#user-id").value;
                        const account_no = document.querySelector("#account-no").value;
                        const bank_code = document.querySelector("#bank-code").value;
                        const bank_name = document.querySelector("#bank-name").value;
                        const owner_name = document.querySelector("#owner-name").value;

                        var data = new FormData();

                        if(creator_name !== "") {
                            data.append("creatorName", creator_name);
                        }
                        if(user_id !== "") {
                            data.append("userId", user_id);
                        }
                        if(account_no !== "" && bank_code !== "" && bank_name !== "" && owner_name !== "") {
                            data.append("productCreatorAccounts[0].accountNo", account_no);
                            data.append("productCreatorAccounts[0].bankCode", bank_code);
                            data.append("productCreatorAccounts[0].bankName", bank_name);
                            data.append("productCreatorAccounts[0].ownerName", owner_name);
                        }

                        send(data);
                    });

                    form.appendChild(title_div);
                    form.appendChild(name_div);
                    form.appendChild(id_div);
                    form.appendChild(account_no_div);
                    form.appendChild(bank_code_div);
                    form.appendChild(bank_name_div);
                    form.appendChild(owner_name_div);
                    form.appendChild(submit_btn);

                    popup.appendChild(form);
                });

                // 데이터 전송
                function send(data) {
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function(e) {
                        if (xhr.readyState == 4) {
                            if (xhr.status == 200) {
                                result = JSON.parse(xhr.responseText);
                                data = result.result;
                                popup_reg.close();
                                table.body("page=0", bodydata);
                                alert("등록에 성공하였습니다.");
                            } else {
                                alert("등록에 실패하였습니다.");
                                // console.log("xhr error");
                            }
                        }
                    }
                    xhr.open("POST", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/productCreator", true);
                    xhr.send(data);
                }

                // [버튼] 등록
                document.querySelector("#ac-btn-regist").addEventListener("click", function(e) {
                    e.preventDefault();
                    popup_reg.open();
                });
            }
        </script>
    </head>
    <body class="ac">
        <div class="wrapper">
            <div class="content">
                <div id="ac-btn-regist" class="ac-table-btn-regist">
                    등록
                </div>
                <div id="ac-table-paging" class="ac-table-paging">

                </div>
                <div id="ac-table-head" class="ac-table-head">
                    <div class="column">번호</div>
                    <div class="column">아이디</div>
                    <div class="column">이름</div>
                    <div class="column">관리</div>
                </div>
                <div id="ac-table" class="ac-table">

                </div>
            </div>
            <div class="nav reduction">
                <div class="nav-head">
                    <div class="nav-head-expander">
                        <i class="material-icons">
                            first_page
                        </i>
                    </div>
                    <div class="nav-head-logo">
                        Auto Cropper
                    </div>
                </div>
                <div class="nav-body">
                    <div class="nav-body-menu">
                        <div class="menu-item" data-page="edit">
                            <i class="material-icons">
                                crop_free
                            </i>
                            edit
                        </div>
                        <div class="menu-item" data-page="auto">
                            <i class="material-icons">
                                style
                            </i>
                            auto
                        </div>
                        <div class="menu-item active" data-page="creator">
                            <i class="material-icons">
                                people
                            </i>
                            creator
                        </div>
                        <div class="menu-item" data-page="maker">
                            <i class="material-icons">
                                build
                            </i>
                            maker
                        </div>
                        <div class="menu-item" data-page="product">
                            <i class="material-icons">
                                local_mall
                            </i>
                            product
                        </div>
                    </div>
                    <div class="nav-body-content">

                    </div>
                </div>
            </div>
        </div>
    </body>
</html>