<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Auto Cropper</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <link href="./css/common.css" rel="stylesheet" />
        <link href="./subproject/css/maker.css" rel="stylesheet" />

        <!-- 공통 -->
        <script type="text/javascript" src="./js/common.js"></script>

        <!-- 셀렉트박스 모듈 -->
        <!-- <script type="text/javascript" src="./js/selectbox_core_module.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/selectbox.css" /> -->

        <!-- 테이블 모듈 -->
        <script type="text/javascript" src="./js/table_core_module.js"></script>
        <link href="./css/table.css" rel="stylesheet" />

        <!-- 팝업 모듈 -->
        <script type="text/javascript" src="./js/popup_core_module.js"></script>
        <link href="./css/popup.css" rel="stylesheet" />

        <script>
            window.onload = function() {
                common.menu();
                common.expander();

                // const table = new Table("data/creator.json");
                const table = new Table("http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/packageCreators");
                table.body("page=0", bodydata);

                function bodydata(item, target) {
                    // DIV ROW 생성
                    const row = document.createElement("div");
                    row.classList.add("ac-table-row");

                    // DIV COLUM 생성, 데이터를 어떻게 파싱할지
                    // 번호
                    const column_01 = document.createElement("div");
                    column_01.id = "ac-maker-number";
                    column_01.style.width = "80px";
                    column_01.innerText = item.id;
                    column_01.classList.add("ac-table-column");
                    
                    // 이름
                    const column_02 = document.createElement("div");
                    column_02.id = "ac-maker-name";
                    column_02.style.width = "150px";
                    column_02.innerText = item.name;
                    column_02.classList.add("ac-table-column");

                    // 연락처
                    const column_03 = document.createElement("div");
                    column_03.id = "ac-maker-contact";
                    column_03.style.width = "150px";
                    column_03.innerText = item.contact;
                    column_03.classList.add("ac-table-column");

                    // 이메일
                    const column_04 = document.createElement("div");
                    column_04.id = "ac-maker-email";
                    column_04.style.width = "200px";
                    column_04.innerText = item.email;
                    column_04.classList.add("ac-table-column");

                    // 사업자 번호
                    const column_05 = document.createElement("div");
                    column_05.id = "ac-maker-corpregno";
                    column_05.style.width = "200px";
                    column_05.innerText = item.corpRegNo;
                    column_05.classList.add("ac-table-column");

                    const btn_editor = document.createElement("div");
                    // btn_editor.id = "ac-btn-detail";
                    btn_editor.setAttribute("data-id", item.id);
                    btn_editor.innerText = "수정";
                    btn_editor.classList.add("btn");
                    btn_editor.classList.add("ac-table-btn-editor");
                    btn_editor.addEventListener("click", function(e) {
                        e.preventDefault();
                        // popup 수정
                        const form = document.querySelector("#maker-editor");
                        form.querySelector("#editor-maker-id").value = item.id;
                        form.querySelector("#editor-maker-name").value = item.name;
                        form.querySelector("#editor-maker-contact").value = item.contact;
                        form.querySelector("#editor-maker-email").value = item.email;
                        form.querySelector("#editor-corp-reg-no").value = item.corpRegNo;
                        form.querySelector("#editor-delivery-address").value = item.deliveryAddress;
                        form.querySelector("#editor-delivery-address-zipcode").value = item.deliveryAddressZipCode;
                        form.querySelector("#editor-return-address").value = item.returnAddress;
                        form.querySelector("#editor-return-address-zipcode").value = item.returnAddressZipCode;

                        popup_editor.open();
                    });

                    const column_06 = document.createElement("div");
                    column_06.id = "ac-maker-setting";
                    column_06.style.width = "150px";
                    column_06.classList.add("ac-table-column");
                    column_06.appendChild(btn_editor);

                    row.appendChild(column_01);
                    row.appendChild(column_02);
                    row.appendChild(column_03);
                    row.appendChild(column_04);
                    row.appendChild(column_05);
                    row.appendChild(column_06);

                    target.appendChild(row);
                }

                const popup_regist = new Popup("제조사 등록");
                // 실제 팝업창에 그려질 form 문 작성
                popup_regist.init(function(popup) {
                    const form = document.createElement("form");
                    form.id = "maker-regist";
                    form.style.display = "flex";
                    form.style.flexDirection = "column";
                    form.style.alignItems = "center";
                    form.style.padding = "0px 30px";

                    // 이름
                    const name_div = document.createElement("div");
                    name_div.style.marginTop = "45px";
                    const name_label = document.createElement("div");
                    name_label.innerText = "제조사 이름";
                    name_label.classList.add("popup-label");
                    const name = document.createElement("input");
                    name.id = "regist-maker-name";
                    name.classList.add("popup-input");
                    name.setAttribute("name", "name");
                    name.setAttribute("autocomplete", "off");
                    name_div.appendChild(name_label);
                    name_div.appendChild(name);

                    // 연락처
                    const contact_div = document.createElement("div");
                    contact_div.style.marginTop = "20px";
                    const contact_label = document.createElement("div");
                    contact_label.innerText = "연락처";
                    contact_label.classList.add("popup-label");
                    const contact = document.createElement("input");
                    contact.id = "regist-maker-contact";
                    contact.classList.add("popup-input");
                    contact.setAttribute("name", "contact");
                    contact.setAttribute("autocomplete", "off");
                    contact_div.appendChild(contact_label);
                    contact_div.appendChild(contact);

                    // 이메일
                    const email_div = document.createElement("div");
                    email_div.style.marginTop = "20px";
                    const email_label = document.createElement("div");
                    email_label.innerText = "이메일";
                    email_label.classList.add("popup-label");
                    const email = document.createElement("input");
                    email.id = "regist-maker-email";
                    email.classList.add("popup-input");
                    email.setAttribute("name", "email");
                    email.setAttribute("autocomplete", "off");
                    email_div.appendChild(email_label);
                    email_div.appendChild(email);

                    // 사업자 번호
                    const corpregno_div = document.createElement("div");
                    corpregno_div.style.marginTop = "20px";
                    const corpregno_label = document.createElement("div");
                    corpregno_label.innerText = "사업자 번호";
                    corpregno_label.classList.add("popup-label");
                    const corpregno = document.createElement("input");
                    corpregno.id = "regist-corp-reg-no";
                    corpregno.classList.add("popup-input");
                    corpregno.setAttribute("name", "corpRegNo");
                    corpregno.setAttribute("autocomplete", "off");
                    corpregno_div.appendChild(corpregno_label);
                    corpregno_div.appendChild(corpregno);

                    // 출고지
                    const delivery_address_div = document.createElement("div");
                    delivery_address_div.style.marginTop = "20px";
                    const delivery_address_label = document.createElement("div");
                    delivery_address_label.innerText = "출고지";
                    delivery_address_label.classList.add("popup-label");
                    const delivery_address = document.createElement("input");
                    delivery_address.id = "regist-delivery-address";
                    delivery_address.classList.add("popup-input");
                    delivery_address.setAttribute("name", "deliveryAddress");
                    delivery_address.setAttribute("autocomplete", "off");
                    delivery_address_div.appendChild(delivery_address_label);
                    delivery_address_div.appendChild(delivery_address);

                    // 출고지 우편번호
                    const delivery_address_zipcode_div = document.createElement("div");
                    delivery_address_zipcode_div.style.marginTop = "20px";
                    const delivery_address_zipcode_label = document.createElement("div");
                    delivery_address_zipcode_label.innerText = "출고지 우편번호";
                    delivery_address_zipcode_label.classList.add("popup-label");
                    const delivery_address_zipcode = document.createElement("input");
                    delivery_address_zipcode.id = "regist-delivery-address-zipcode";
                    delivery_address_zipcode.classList.add("popup-input");
                    delivery_address_zipcode.setAttribute("name", "deliveryAddressZipCode");
                    delivery_address_zipcode.setAttribute("autocomplete", "off");
                    delivery_address_zipcode_div.appendChild(delivery_address_zipcode_label);
                    delivery_address_zipcode_div.appendChild(delivery_address_zipcode);

                    // 반품지
                    const return_address_div = document.createElement("div");
                    return_address_div.style.marginTop = "20px";
                    const return_address_label = document.createElement("div");
                    return_address_label.innerText = "반품지";
                    return_address_label.classList.add("popup-label");
                    const return_address = document.createElement("input");
                    return_address.id = "regist-return-address";
                    return_address.classList.add("popup-input");
                    return_address.setAttribute("name", "returnAddress");
                    return_address.setAttribute("autocomplete", "off");
                    return_address_div.appendChild(return_address_label);
                    return_address_div.appendChild(return_address);

                    // 반품지 우편번호
                    const return_address_zipcode_div = document.createElement("div");
                    return_address_zipcode_div.style.marginTop = "20px";
                    const return_address_zipcode_label = document.createElement("div");
                    return_address_zipcode_label.innerText = "반품지 우편번호";
                    return_address_zipcode_label.classList.add("popup-label");
                    const return_address_zipcode = document.createElement("input");
                    return_address_zipcode.id = "regist-return-address-zipcode";
                    return_address_zipcode.classList.add("popup-input");
                    return_address_zipcode.setAttribute("name", "returnAddressZipCode");
                    return_address_zipcode.setAttribute("autocomplete", "off");
                    return_address_zipcode_div.appendChild(return_address_zipcode_label);
                    return_address_zipcode_div.appendChild(return_address_zipcode);

                    // 버튼
                    const submit_btn = document.createElement("div");
                    submit_btn.innerText = "완료";
                    submit_btn.classList.add("popup-button");
                    submit_btn.addEventListener("click", function(e) {
                        e.preventDefault();

                        // 하나씩 파싱해서 데이터 저장
                        const form = document.querySelector("#maker-regist");
                        const maker_name = form.querySelector("#regist-maker-name").value;
                        const maker_contact = form.querySelector("#regist-maker-contact").value;
                        const maker_email = form.querySelector("#regist-maker-email").value;
                        const corp_reg_no = form.querySelector("#regist-corp-reg-no").value;
                        const delivery_address = form.querySelector("#regist-delivery-address").value;
                        const delivery_address_zipcode = form.querySelector("#regist-delivery-address-zipcode").value;
                        const return_address = form.querySelector("#regist-return-address").value;
                        const return_address_zipcode = form.querySelector("#regist-return-address-zipcode").value;

                        var data = new FormData();

                        if(maker_name !== "") {
                            data.append("name", maker_name);
                        }
                        if(maker_contact !== "") {
                            data.append("contact", maker_contact);
                        }
                        if(maker_email !== "") {
                            data.append("email", maker_email);
                        }
                        if(corp_reg_no !== "") {
                            data.append("corpRegNo", corp_reg_no);
                        }
                        if(delivery_address !== "") {
                            data.append("deliveryAddress", delivery_address);
                        }
                        if(delivery_address_zipcode !== "") {
                            data.append("deliveryAddressZipCode", delivery_address_zipcode);
                        }
                        if(return_address !== "") {
                            data.append("returnAddress", return_address);
                        }
                        if(return_address_zipcode !== "") {
                            data.append("returnAddressZipCode", return_address_zipcode);
                        }

                        sendRegist(data);
                    });

                    // 데이터 전송
                    function sendRegist(data) {
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function(e) {
                            if (xhr.readyState == 4) {
                                if(xhr.status == 200) {
                                    const result = JSON.parse(xhr.responseText);
                                    const data = result.result;
                                    popup_regist.close();
                                    table.body("page=0", bodydata);
                                    alert("등록에 성공하였습니다.");
                                } else {
                                    alert("등록에 실패하였습니다.");
                                }
                            }
                        }
                        xhr.open("POST", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/packageCreator", true);
                        xhr.send(data);
                    }

                    form.appendChild(name_div);
                    form.appendChild(contact_div);
                    form.appendChild(email_div);
                    form.appendChild(corpregno_div);
                    form.appendChild(delivery_address_div);
                    form.appendChild(delivery_address_zipcode_div);
                    form.appendChild(return_address_div);
                    form.appendChild(return_address_zipcode_div);
                    form.appendChild(submit_btn);

                    popup.appendChild(form);
                });

                // [버튼] 등록
                document.querySelector("#ac-btn-regist").addEventListener("click", function(e) {
                    e.preventDefault();
                    popup_regist.open();
                });

                const popup_editor = new Popup("제조사 수정");
                // 실제 팝업창에 그려질 form 문 작성
                popup_editor.init(function(popup) {
                    const form = document.createElement("form");
                    form.id = "maker-editor";
                    form.style.display = "flex";
                    form.style.flexDirection = "column";
                    form.style.alignItems = "center";
                    form.style.padding = "0px 30px";

                    // 번호
                    const id_div = document.createElement("div");
                    id_div.style.marginTop = "45px";
                    const id_label = document.createElement("div");
                    id_label.innerText = "번호";
                    id_label.classList.add("popup-label");
                    const id = document.createElement("input");
                    id.id = "editor-maker-id";
                    id.classList.add("popup-input");
                    id.setAttribute("name", "id");
                    id.setAttribute("autocomplete", "off");
                    id.readOnly = true;
                    id_div.appendChild(id_label);
                    id_div.appendChild(id);

                    // 이름
                    const name_div = document.createElement("div");
                    name_div.style.marginTop = "20px";
                    const name_label = document.createElement("div");
                    name_label.innerText = "제조사 이름";
                    name_label.classList.add("popup-label");
                    const name = document.createElement("input");
                    name.id = "editor-maker-name";
                    name.classList.add("popup-input");
                    name.setAttribute("name", "name");
                    name.setAttribute("autocomplete", "off");
                    name_div.appendChild(name_label);
                    name_div.appendChild(name);

                    // 연락처
                    const contact_div = document.createElement("div");
                    contact_div.style.marginTop = "20px";
                    const contact_label = document.createElement("div");
                    contact_label.innerText = "연락처";
                    contact_label.classList.add("popup-label");
                    const contact = document.createElement("input");
                    contact.id = "editor-maker-contact";
                    contact.classList.add("popup-input");
                    contact.setAttribute("name", "contact");
                    contact.setAttribute("autocomplete", "off");
                    contact_div.appendChild(contact_label);
                    contact_div.appendChild(contact);

                    // 이메일
                    const email_div = document.createElement("div");
                    email_div.style.marginTop = "20px";
                    const email_label = document.createElement("div");
                    email_label.innerText = "이메일";
                    email_label.classList.add("popup-label");
                    const email = document.createElement("input");
                    email.id = "editor-maker-email";
                    email.classList.add("popup-input");
                    email.setAttribute("name", "email");
                    email.setAttribute("autocomplete", "off");
                    email_div.appendChild(email_label);
                    email_div.appendChild(email);

                    // 사업자 번호
                    const corpregno_div = document.createElement("div");
                    corpregno_div.style.marginTop = "20px";
                    const corpregno_label = document.createElement("div");
                    corpregno_label.innerText = "사업자 번호";
                    corpregno_label.classList.add("popup-label");
                    const corpregno = document.createElement("input");
                    corpregno.id = "editor-corp-reg-no";
                    corpregno.classList.add("popup-input");
                    corpregno.setAttribute("name", "corpRegNo");
                    corpregno.setAttribute("autocomplete", "off");
                    corpregno_div.appendChild(corpregno_label);
                    corpregno_div.appendChild(corpregno);

                    // 출고지
                    const delivery_address_div = document.createElement("div");
                    delivery_address_div.style.marginTop = "20px";
                    const delivery_address_label = document.createElement("div");
                    delivery_address_label.innerText = "출고지";
                    delivery_address_label.classList.add("popup-label");
                    const delivery_address = document.createElement("input");
                    delivery_address.id = "editor-delivery-address";
                    delivery_address.classList.add("popup-input");
                    delivery_address.setAttribute("name", "deliveryAddress");
                    delivery_address.setAttribute("autocomplete", "off");
                    delivery_address_div.appendChild(delivery_address_label);
                    delivery_address_div.appendChild(delivery_address);

                    // 출고지 우편번호
                    const delivery_address_zipcode_div = document.createElement("div");
                    delivery_address_zipcode_div.style.marginTop = "20px";
                    const delivery_address_zipcode_label = document.createElement("div");
                    delivery_address_zipcode_label.innerText = "출고지 우편번호";
                    delivery_address_zipcode_label.classList.add("popup-label");
                    const delivery_address_zipcode = document.createElement("input");
                    delivery_address_zipcode.id = "editor-delivery-address-zipcode";
                    delivery_address_zipcode.classList.add("popup-input");
                    delivery_address_zipcode.setAttribute("name", "deliveryAddressZipCode");
                    delivery_address_zipcode.setAttribute("autocomplete", "off");
                    delivery_address_zipcode_div.appendChild(delivery_address_zipcode_label);
                    delivery_address_zipcode_div.appendChild(delivery_address_zipcode);

                    // 반품지
                    const return_address_div = document.createElement("div");
                    return_address_div.style.marginTop = "20px";
                    const return_address_label = document.createElement("div");
                    return_address_label.innerText = "반품지";
                    return_address_label.classList.add("popup-label");
                    const return_address = document.createElement("input");
                    return_address.id = "editor-return-address";
                    return_address.classList.add("popup-input");
                    return_address.setAttribute("name", "returnAddress");
                    return_address.setAttribute("autocomplete", "off");
                    return_address_div.appendChild(return_address_label);
                    return_address_div.appendChild(return_address);

                    // 반품지 우편번호
                    const return_address_zipcode_div = document.createElement("div");
                    return_address_zipcode_div.style.marginTop = "20px";
                    const return_address_zipcode_label = document.createElement("div");
                    return_address_zipcode_label.innerText = "반품지 우편번호";
                    return_address_zipcode_label.classList.add("popup-label");
                    const return_address_zipcode = document.createElement("input");
                    return_address_zipcode.id = "editor-return-address-zipcode";
                    return_address_zipcode.classList.add("popup-input");
                    return_address_zipcode.setAttribute("name", "returnAddressZipCode");
                    return_address_zipcode.setAttribute("autocomplete", "off");
                    return_address_zipcode_div.appendChild(return_address_zipcode_label);
                    return_address_zipcode_div.appendChild(return_address_zipcode);

                    // 버튼
                    const submit_btn = document.createElement("div");
                    submit_btn.innerText = "완료";
                    submit_btn.classList.add("popup-button");
                    submit_btn.addEventListener("click", function(e) {
                        e.preventDefault();

                        // 하나씩 파싱해서 데이터 저장
                        const form = document.querySelector("#maker-editor");
                        const maker_id = form.querySelector("#editor-maker-id").value;
                        const maker_name = form.querySelector("#editor-maker-name").value;
                        const maker_contact = form.querySelector("#editor-maker-contact").value;
                        const maker_email = form.querySelector("#editor-maker-email").value;
                        const corp_reg_no = form.querySelector("#editor-corp-reg-no").value;
                        const delivery_address = form.querySelector("#editor-delivery-address").value;
                        const delivery_address_zipcode = form.querySelector("#editor-delivery-address-zipcode").value;
                        const return_address = form.querySelector("#editor-return-address").value;
                        const return_address_zipcode = form.querySelector("#editor-return-address-zipcode").value;

                        var data = new FormData();

                        if(maker_id !== "") {
                            data.append("id", maker_id);
                        }
                        if(maker_name !== "") {
                            data.append("name", maker_name);
                        }
                        if(maker_contact !== "") {
                            data.append("contact", maker_contact);
                        }
                        if(maker_email !== "") {
                            data.append("email", maker_email);
                        }
                        if(corp_reg_no !== "") {
                            data.append("corpRegNo", corp_reg_no);
                        }
                        if(delivery_address !== "") {
                            data.append("deliveryAddress", delivery_address);
                        }
                        if(delivery_address_zipcode !== "") {
                            data.append("deliveryAddressZipCode", delivery_address_zipcode);
                        }
                        if(return_address !== "") {
                            data.append("returnAddress", return_address);
                        }
                        if(return_address_zipcode !== "") {
                            data.append("returnAddressZipCode", return_address_zipcode);
                        }

                        sendEditor(data);
                    });

                    // 데이터 전송
                    function sendEditor(data) {
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function(e) {
                            if (xhr.readyState == 4) {
                                if(xhr.status == 200) {
                                    const result = JSON.parse(xhr.responseText);
                                    const data = result.result;
                                    popup_editor.close();
                                    table.body("page=0", bodydata);
                                    alert("수정에 성공하였습니다.");
                                } else {
                                    alert("수정에 실패하였습니다.");
                                }
                            }
                        }
                        xhr.open("PUT", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/packageCreator", true);
                        xhr.send(data);
                    }

                    form.appendChild(id_div);
                    form.appendChild(name_div);
                    form.appendChild(contact_div);
                    form.appendChild(email_div);
                    form.appendChild(corpregno_div);
                    form.appendChild(delivery_address_div);
                    form.appendChild(delivery_address_zipcode_div);
                    form.appendChild(return_address_div);
                    form.appendChild(return_address_zipcode_div);
                    form.appendChild(submit_btn);

                    popup.appendChild(form);
                });
            }
        </script>
    </head>
    <body class="ac">
        <div class="wrapper">
            <div class="head">
                Auto Cropper
            </div>
            <div class="menu">
                <div class="logo">
                    <img src="./img/ac-logo.png">
                </div>
                <div class="platform">
                    <img src="./img/ac-platform.png">
                </div>
                <div class="menu-item" data-page="creator">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-creator.png">
                    </div>
                    <div class="menu-item-text">
                        Creator
                    </div>
                </div>
                <div class="menu-item active" data-page="maker">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-maker-active.png">
                    </div>
                    <div class="menu-item-text">
                        Maker
                    </div>
                </div>
                <div class="menu-item" data-page="package">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-package.png">
                    </div>
                    <div class="menu-item-text">
                        Package
                    </div>
                </div>
                <div class="menu-item" data-page="edit">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-edit.png">
                    </div>
                    <div class="menu-item-text">
                        Edit
                    </div>
                </div>
                <div class="menu-item" data-page="auto">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-auto.png">
                    </div>
                    <div class="menu-item-text">
                        Auto
                    </div>
                </div>
                <div class="menu-item" data-page="product">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-product.png">
                    </div>
                    <div class="menu-item-text">
                        Product
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="ac-table">
                    <div class="ac-table-tool">
                        <div id="ac-btn-regist" class="ac-table-btn-regist">
                            등록 +
                        </div>
                    </div>
                    <div id="ac-table-head" class="ac-table-head">
                        <div class="column">번호</div>
                        <div class="column">이름</div>
                        <div class="column">연락처</div>
                        <div class="column">이메일</div>
                        <div class="column">사업자 번호</div>
                        <div class="column">관리</div>
                    </div>
                    <div id="ac-table-body" class="ac-table-body">
    
                    </div>
                    <div id="ac-table-paging" class="ac-table-paging">
    
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>