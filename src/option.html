<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Auto Cropper</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <link href="./css/common.css" rel="stylesheet" />
        <link href="./subproject/css/option.css" rel="stylesheet" />

        <script src="http://sdk.amazonaws.com/js/aws-sdk-2.1.24.min.js"></script>

        <!-- 공통 -->
        <script type="text/javascript" src="./js/common.js"></script>

        <!-- 오토크로퍼 모듈 -->
        <script type="text/javascript" src="./js/cropper_core_module.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/cropper.css" />

        <!-- 셀렉트박스 모듈 -->
        <!-- <script type="text/javascript" src="./js/selectbox_core_module.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/selectbox.css" /> -->

        <!-- 테이블 모듈 -->
        <script type="text/javascript" src="./js/table_core_module.js"></script>
        <link href="./css/table.css" rel="stylesheet" />

        <!-- 팝업 모듈 -->
        <script type="text/javascript" src="./js/popup_core_module.js"></script>
        <link href="./css/popup.css" rel="stylesheet" />

        <!-- 모멘트JS -->
        <script src="./libs/moment/moment.min.js"></script>

        <script>
            window.onload = function() {
                const host = window.location.host;

                common.menu();
                common.expander();

                palette_color = {
                    color01: "#ffffff",
                    color02: "#B6B5B5",
                    color03: "#54B689",
                    color04: "#A093D6",
                    color05: "#7BB2E3",
                    color06: "#D34249",
                }
                
                // 아이디를 통해 크리에이터 정보 조회
                const id = window.location.search.substring(1).split("=")[1];

                // 데이터 획득
                function fetch(id) {
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function(e) {
                        if (xhr.readyState == 4) {
                            if (xhr.status == 200) {
                                const result = JSON.parse(xhr.responseText);
                                const data = result.result;
                                parsing(data);
                            } else {
                                console.log("xhr error");
                            }
                        }
                    }
                    xhr.open("GET", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/package/" + id, true);
                    xhr.send();
                }
                fetch(id);

                // 데이터 파싱[+ UI생성]
                function parsing(data) {
                    document.querySelector("#package-name").innerText = data.name;
                    document.querySelector("#package-creator").innerText = data.packageCreator.name;
                    document.querySelector("#package-cost").innerText = common.numberWithCommas(data.packagePrice.cost) + "원";
                    document.querySelector("#package-price").innerText = common.numberWithCommas(data.packagePrice.price) + "원";

                    const option_list = document.querySelector("#option-list");
                    option_list.innerHTML = "";

                    // 리스트 만들기 - 캔버스 활용여부, 옵션네임 활용여부
                    const options = data.packageOptions;
                    for(option of options) {
                        // console.log(option);
                        let path = option.imagePath;
                        const mock_img = option.mockupImage.find(item => item.indexOf("effect") == -1 && item.indexOf("area") == -1);
                        const area_img = option.mockupImage.find(item => item.indexOf("area") > -1);
                        const effect_img = option.mockupImage.find(item => item.indexOf("effect") > -1);
                        const color_code = option.mockFilling;

                        if(host === "127.0.0.1:5500" 
                            || host === "localhost:5500" 
                            || host === "192.167.0.177:5500") {
                            path = "/cropper/src" + path;
                        }

                        const temp = new Cropper({
                            mode: "autopacking",
                            mock_img: path + mock_img,
                            area_img: path + area_img,
                            asset_img: undefined,
                            effect_img: path + effect_img,
                            color_code: color_code,
                            canvas_size: "250px"
                        }, {
                            top: parseFloat(option.mockTop),
                            left: parseFloat(option.mockLeft),
                            width: parseFloat(option.mockWidth),
                            height: parseFloat(option.mockHeight)
                        }, palette_color);
                        temp.init();
                        temp.setParam(undefined, option);

                        // 옵션데이터 넣을 방법 확인
                        const edit_btn = document.createElement("div");
                        edit_btn.innerText = "";
                        edit_btn.style.position = "absolute";
                        edit_btn.style.top = "20px";
                        edit_btn.style.right = "20px";
                        edit_btn.style.width = "20px";
                        edit_btn.style.minHeight = "20px";
                        // edit_btn.style.backgroundColor = "#8fd5b5";
                        // edit_btn.style.borderRadius = "50%";
                        edit_btn.style.backgroundImage = "url('./img/icon-edit.png')";
                        edit_btn.style.backgroundSize = "cover";
                        edit_btn.style.backgroundRepeat = "no-repeat";
                        edit_btn.style.backgroundPosition = "center";
                        edit_btn.style.color = "#FFFFFF";
                        edit_btn.style.display = "flex";
                        edit_btn.style.justifyContent = "center";
                        edit_btn.style.alignItems = "center";
                        edit_btn.style.cursor = "pointer";
                        edit_btn.style.zIndex = "4";
                        edit_btn.setAttribute("data-id", option.id);
                        edit_btn.addEventListener("click", function(e) {
                            e.preventDefault();

                            const form = document.querySelector("#option-editor");
                            form.querySelector("#editor-option-id").value = option.id;
                            form.querySelector("#editor-option-name1").value = option.optionName1;
                            form.querySelector("#editor-option-name2").value = option.optionName2;
                            form.querySelector("#editor-option-cost").value = option.cost;
                            form.querySelector("#editor-option-price").value = option.price;
                            form.querySelector("#editor-option-image-path").value = option.imagePath;
                            form.querySelector("#editor-option-mock-filling").value = option.mockFilling;
                            form.querySelector("#editor-option-mock-height").value = option.mockHeight;
                            form.querySelector("#editor-option-mock-width").value = option.mockWidth;
                            form.querySelector("#editor-option-mock-top").value = option.mockTop;
                            form.querySelector("#editor-option-mock-left").value = option.mockLeft;
                            form.querySelector("#editor-option-mock-image-array").value = option.mockupImage.join();
                            form.querySelector("#editor-option-status").value = option.status;

                            // 수정버튼
                            popup_editor.open();
                            console.log(temp.getParam());
                        });
                        const target = temp.getTarget();

                        const hover_div = document.createElement("div");
                        hover_div.classList.add("hover-div");

                        const hover_option_name = document.createElement("div");
                        hover_option_name.classList.add("hover-option-name");
                        hover_option_name.innerText = option.optionName1 + (option.optionName2 == null ? "" : " - " + option.optionName2);

                        const hover_option_package_creator = document.createElement("div");
                        hover_option_package_creator.classList.add("hover-option-package-creator");
                        hover_option_package_creator.innerText = data.packageCreator.name;

                        hover_div.appendChild(hover_option_name);
                        hover_div.appendChild(hover_option_package_creator);

                        target.appendChild(edit_btn);
                        target.appendChild(hover_div);
                    }
                }

                // 등록 팝업
                const popup_regist = new Popup("옵션 등록");
                // 실제 팝업창에 그려질 form 문 작성
                popup_regist.setParam(new FormData());	// formData 생성
                popup_regist.init(function(popup) {
                    const form = document.createElement("form");
                    form.id = "option-regist";
                    form.style.display = "flex";
                    form.style.flexDirection = "column";
                    form.style.alignItems = "center";
                    form.style.padding = "0px 30px";

                    // 옵션 이름1
                    const option_name1_div = document.createElement("div");
                    option_name1_div.style.marginTop = "45px";
                    const option_name1_label = document.createElement("div");
                    option_name1_label.innerText = "옵션 이름1";
                    option_name1_label.classList.add("popup-label");
                    const option_name1 = document.createElement("input");
                    option_name1.id = "regist-option-name1";
                    option_name1.classList.add("popup-input");
                    option_name1.setAttribute("name", "optionName1");
                    option_name1.setAttribute("autocomplete", "off");
                    option_name1_div.appendChild(option_name1_label);
                    option_name1_div.appendChild(option_name1);

                    // 옵션 이름2
                    const option_name2_div = document.createElement("div");
                    option_name2_div.style.marginTop = "20px";
                    const option_name2_label = document.createElement("div");
                    option_name2_label.innerText = "옵션 이름2";
                    option_name2_label.classList.add("popup-label");
                    const option_name2 = document.createElement("input");
                    option_name2.id = "regist-option-name2";
                    option_name2.classList.add("popup-input");
                    option_name2.setAttribute("name", "optionName2");
                    option_name2.setAttribute("autocomplete", "off");
                    option_name2_div.appendChild(option_name2_label);
                    option_name2_div.appendChild(option_name2);

                    // 비용
                    const cost_div = document.createElement("div");
                    cost_div.style.marginTop = "20px";
                    const cost_label = document.createElement("div");
                    cost_label.innerText = "비용";
                    cost_label.classList.add("popup-label");
                    const cost = document.createElement("input");
                    cost.id = "regist-option-cost";
                    cost.classList.add("popup-input");
                    cost.setAttribute("name", "cost");
                    cost.setAttribute("autocomplete", "off");
                    cost_div.appendChild(cost_label);
                    cost_div.appendChild(cost);

                    // 가격
                    const price_div = document.createElement("div");
                    price_div.style.marginTop = "20px";
                    const price_label = document.createElement("div");
                    price_label.innerText = "가격";
                    price_label.classList.add("popup-label");
                    const price = document.createElement("input");
                    price.id = "regist-option-price";
                    price.classList.add("popup-input");
                    price.setAttribute("name", "price");
                    price.setAttribute("autocomplete", "off");
                    price_div.appendChild(price_label);
                    price_div.appendChild(price);

                    // mock 이미지 base
                    const mock_image_base_div = document.createElement("div");
                    mock_image_base_div.style.marginTop = "20px";
                    const mock_image_base_label = document.createElement("div");
                    mock_image_base_label.innerText = "MOCK 기본 이미지(?.png)";
                    mock_image_base_label.classList.add("popup-label");
                    const mock_image_base = document.createElement("input");
                    mock_image_base.type = "file";
                    mock_image_base.id = "regist-option-mock-image-base";
                    mock_image_base.classList.add("popup-input");
                    mock_image_base.setAttribute("name", "images");
                    mock_image_base.setAttribute("autocomplete", "off");
                    mock_image_base.addEventListener("change", function(e) {
                        const reader = new FileReader();
                        let filename = typeof e.target.files[0] === "object" ? e.target.files[0].name : "new_file.png";
                        // 영역
                        if(filename.indexOf("_area") > -1) {
                            filename = filename.substring(0, filename.indexOf("_area")) + filename.substring(filename.indexOf("_area") + "_area".length, filename.length);
                        }
                        // 효과
                        if(filename.indexOf("_effect") > -1) {
                            filename = filename.substring(0, filename.indexOf("_effect")) + filename.substring(filename.indexOf("_effect") + "_effect".length, filename.length);
                        }
                        reader.onload = function(event) {
                            mock_image_base.setAttribute("disabled", true);
                            const result = event.target.result;
                            const blob_bin = window.atob(result.split(',')[1]);	// base64 데이터 디코딩
                            const array = [];
                            for (let i = 0; i < blob_bin.length; i++) {
                                array.push(blob_bin.charCodeAt(i));
                            }
                            const blob = new Blob([new Uint8Array(array)], {type: 'image/png'});	// Blob 생성
                            popup_regist.getParam().append("images", blob, filename);	            // file data 추가

                            // 사이즈
                            var size = 0;
                            for(let pair of popup_regist.getParam().entries()) { size++; }
                            if(size == 3) {
                                if(confirm("정말 업로드를 진행하시겠습니다.")) {
                                    optionImageUpload(popup_regist.getParam());
                                } else {
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                }
                            }
                        }
                        reader.readAsDataURL(e.target.files[0]);
                    });
                    mock_image_base_div.appendChild(mock_image_base_label);
                    mock_image_base_div.appendChild(mock_image_base);

                    // mock 이미지 area
                    const mock_image_area_div = document.createElement("div");
                    mock_image_area_div.style.marginTop = "20px";
                    const mock_image_area_label = document.createElement("div");
                    mock_image_area_label.innerText = "MOCK 범위 이미지(?_area.png)";
                    mock_image_area_label.classList.add("popup-label");
                    const mock_image_area = document.createElement("input");
                    mock_image_area.type = "file";
                    mock_image_area.id = "regist-option-mock-image-area";
                    mock_image_area.classList.add("popup-input");
                    mock_image_area.setAttribute("name", "images");
                    mock_image_area.setAttribute("autocomplete", "off");
                    mock_image_area.addEventListener("change", function(e) {
                        const reader = new FileReader();
                        let filename = typeof e.target.files[0] === "object" ? e.target.files[0].name : "new_file.png";
                        // 효과
                        if(filename.indexOf("_effect") > -1) {
                            filename = filename.substring(0, filename.indexOf("_effect")) + filename.substring(filename.indexOf("_effect") + "_effect".length, filename.length);
                        }
                        // 영역
                        if(filename.indexOf("_area") == -1) {
                            filename = filename.substring(0, filename.indexOf(".")) + "_area" + filename.substring(filename.indexOf("."), filename.length);
                        }
                        reader.onload = function(event) {
                            mock_image_area.setAttribute("disabled", true);
                            const result = event.target.result;
                            const blob_bin = window.atob(result.split(',')[1]);	// base64 데이터 디코딩
                            const array = [];
                            for (let i = 0; i < blob_bin.length; i++) {
                                array.push(blob_bin.charCodeAt(i));
                            }
                            const blob = new Blob([new Uint8Array(array)], {type: 'image/png'});	// Blob 생성
                            popup_regist.getParam().append("images", blob, filename);	            // file data 추가

                            // 사이즈
                            var size = 0;
                            for(let pair of popup_regist.getParam().entries()) { size++; }
                            if(size == 3) {
                                if(confirm("정말 업로드를 진행하시겠습니다.")) {
                                    optionImageUpload(popup_regist.getParam());
                                } else {
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                }
                            }
                        }
                        reader.readAsDataURL(e.target.files[0]);
                    });
                    mock_image_area_div.appendChild(mock_image_area_label);
                    mock_image_area_div.appendChild(mock_image_area);

                    // mock 이미지 effect
                    const mock_image_effect_div = document.createElement("div");
                    mock_image_effect_div.style.marginTop = "20px";
                    const mock_image_effect_label = document.createElement("div");
                    mock_image_effect_label.innerText = "MOCK 효과 이미지(?_effect.png)";
                    mock_image_effect_label.classList.add("popup-label");
                    const mock_image_effect = document.createElement("input");
                    mock_image_effect.type = "file";
                    mock_image_effect.id = "regist-option-mock-image-effect";
                    mock_image_effect.classList.add("popup-input");
                    mock_image_effect.setAttribute("name", "images");
                    mock_image_effect.setAttribute("autocomplete", "off");
                    mock_image_effect.addEventListener("change", function(e) {
                        const reader = new FileReader();
                        let filename = typeof e.target.files[0] === "object" ? e.target.files[0].name : "new_file.png";
                        // 영역
                        if(filename.indexOf("_area") > -1) {
                            filename = filename.substring(0, filename.indexOf("_area")) + filename.substring(filename.indexOf("_area") + "_area".length, filename.length);
                        }
                        // 효과
                        if(filename.indexOf("_effect") == -1) {
                            filename = filename.substring(0, filename.indexOf(".")) + "_effect" + filename.substring(filename.indexOf("."), filename.length);
                        }
                        reader.onload = function(event) {
                            mock_image_effect.setAttribute("disabled", true);
                            const result = event.target.result;
                            const blob_bin = window.atob(result.split(',')[1]);	// base64 데이터 디코딩
                            const array = [];
                            for (let i = 0; i < blob_bin.length; i++) {
                                array.push(blob_bin.charCodeAt(i));
                            }
                            const blob = new Blob([new Uint8Array(array)], {type: 'image/png'});	// Blob 생성
                            popup_regist.getParam().append("images", blob, filename);	            // file data 추가
                            
                            // 사이즈
                            var size = 0;
                            for(let pair of popup_regist.getParam().entries()) { size++; }
                            if(size == 3) {
                                if(confirm("정말 업로드를 진행하시겠습니다.")) {
                                    optionImageUpload(popup_regist.getParam());
                                } else {
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.value = "";
                                    mock_image_area.value = "";
                                    mock_image_effect.value = "";
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                }
                            }
                        }
                        reader.readAsDataURL(e.target.files[0]);
                    });
                    mock_image_effect_div.appendChild(mock_image_effect_label);
                    mock_image_effect_div.appendChild(mock_image_effect);

                    // 이미지 위치
                    const image_path_div = document.createElement("div");
                    image_path_div.style.marginTop = "20px";
                    const image_path_label = document.createElement("div");
                    image_path_label.innerText = "[자동입력]이미지 위치";
                    image_path_label.classList.add("popup-label");
                    const image_path = document.createElement("input");
                    image_path.id = "regist-option-image-path";
                    image_path.classList.add("popup-input");
                    image_path.setAttribute("name", "imagePath");
                    image_path.setAttribute("readonly", true);
                    image_path.setAttribute("autocomplete", "off");
                    image_path_div.appendChild(image_path_label);
                    image_path_div.appendChild(image_path);

                    // mock 이미지 배열
                    const mock_image_array_div = document.createElement("div");
                    mock_image_array_div.style.marginTop = "20px";
                    const mock_image_array_label = document.createElement("div");
                    mock_image_array_label.innerText = "[자동입력]MOCK 파일 리스트";
                    mock_image_array_label.classList.add("popup-label");
                    const mock_image_array = document.createElement("input");
                    mock_image_array.id = "regist-option-mock-image-array";
                    mock_image_array.classList.add("popup-input");
                    mock_image_array.setAttribute("name", "mockupImage");
                    mock_image_array.setAttribute("readonly", true);
                    mock_image_array.setAttribute("autocomplete", "off");
                    mock_image_array_div.appendChild(mock_image_array_label);
                    mock_image_array_div.appendChild(mock_image_array);

                    // 에셋 높이
                    const mock_height_div = document.createElement("div");
                    mock_height_div.style.marginTop = "20px";
                    const mock_height_label = document.createElement("div");
                    mock_height_label.innerText = "에셋 높이";
                    mock_height_label.classList.add("popup-label");
                    const mock_height = document.createElement("input");
                    mock_height.id = "regist-option-mock-height";
                    mock_height.classList.add("popup-input");
                    mock_height.setAttribute("name", "mockHeight");
                    mock_height.setAttribute("autocomplete", "off");
                    mock_height.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_height.addEventListener("paste", function(e) {
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#regist-option-mock-height").value = option_data.height;
                                document.querySelector("#regist-option-mock-width").value = option_data.width;
                                document.querySelector("#regist-option-mock-top").value = option_data.top;
                                document.querySelector("#regist-option-mock-left").value = option_data.left;
                                document.querySelector("#regist-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_height_div.appendChild(mock_height_label);
                    mock_height_div.appendChild(mock_height);

                    // 에셋 길이
                    const mock_width_div = document.createElement("div");
                    mock_width_div.style.marginTop = "20px";
                    const mock_width_label = document.createElement("div");
                    mock_width_label.innerText = "에셋 길이";
                    mock_width_label.classList.add("popup-label");
                    const mock_width = document.createElement("input");
                    mock_width.id = "regist-option-mock-width";
                    mock_width.classList.add("popup-input");
                    mock_width.setAttribute("name", "mockWidth");
                    mock_width.setAttribute("autocomplete", "off");
                    mock_width.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_width.addEventListener("paste", function(e) {
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#regist-option-mock-height").value = option_data.height;
                                document.querySelector("#regist-option-mock-width").value = option_data.width;
                                document.querySelector("#regist-option-mock-top").value = option_data.top;
                                document.querySelector("#regist-option-mock-left").value = option_data.left;
                                document.querySelector("#regist-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_width_div.appendChild(mock_width_label);
                    mock_width_div.appendChild(mock_width);

                    // 에셋 위치 TOP
                    const mock_top_div = document.createElement("div");
                    mock_top_div.style.marginTop = "20px";
                    const mock_top_label = document.createElement("div");
                    mock_top_label.innerText = "에셋 위치 TOP";
                    mock_top_label.classList.add("popup-label");
                    const mock_top = document.createElement("input");
                    mock_top.id = "regist-option-mock-top";
                    mock_top.classList.add("popup-input");
                    mock_top.setAttribute("name", "mockTop");
                    mock_top.setAttribute("autocomplete", "off");
                    mock_top.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_top.addEventListener("paste", function(e) {
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#regist-option-mock-height").value = option_data.height;
                                document.querySelector("#regist-option-mock-width").value = option_data.width;
                                document.querySelector("#regist-option-mock-top").value = option_data.top;
                                document.querySelector("#regist-option-mock-left").value = option_data.left;
                                document.querySelector("#regist-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_top_div.appendChild(mock_top_label);
                    mock_top_div.appendChild(mock_top);

                    // 에셋 위치 LEFT
                    const mock_left_div = document.createElement("div");
                    mock_left_div.style.marginTop = "20px";
                    const mock_left_label = document.createElement("div");
                    mock_left_label.innerText = "에셋 위치 LEFT";
                    mock_left_label.classList.add("popup-label");
                    const mock_left = document.createElement("input");
                    mock_left.id = "regist-option-mock-left";
                    mock_left.classList.add("popup-input");
                    mock_left.setAttribute("name", "mockLeft");
                    mock_left.setAttribute("autocomplete", "off");
                    mock_left.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_left.addEventListener("paste", function(e) {
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#regist-option-mock-height").value = option_data.height;
                                document.querySelector("#regist-option-mock-width").value = option_data.width;
                                document.querySelector("#regist-option-mock-top").value = option_data.top;
                                document.querySelector("#regist-option-mock-left").value = option_data.left;
                                document.querySelector("#regist-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_left_div.appendChild(mock_left_label);
                    mock_left_div.appendChild(mock_left);

                    // 에셋 배경색
                    const mock_filling_div = document.createElement("div");
                    mock_filling_div.style.marginTop = "20px";
                    const mock_filling_label = document.createElement("div");
                    mock_filling_label.innerText = "에셋 배경색";
                    mock_filling_label.classList.add("popup-label");
                    const mock_filling = document.createElement("input");
                    mock_filling.id = "regist-option-mock-filling";
                    mock_filling.classList.add("popup-input");
                    mock_filling.setAttribute("name", "mockFilling");
                    mock_filling.setAttribute("autocomplete", "off");
                    mock_filling.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_filling.addEventListener("paste", function(e) {
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#regist-option-mock-height").value = option_data.height;
                                document.querySelector("#regist-option-mock-width").value = option_data.width;
                                document.querySelector("#regist-option-mock-top").value = option_data.top;
                                document.querySelector("#regist-option-mock-left").value = option_data.left;
                                document.querySelector("#regist-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_filling_div.appendChild(mock_filling_label);
                    mock_filling_div.appendChild(mock_filling);

                    // 옵션 적용 시작일
                    const start_date_div = document.createElement("div");
                    start_date_div.style.marginTop = "20px";
                    const start_date_label = document.createElement("div");
                    start_date_label.innerText = "옵션 적용 시작일";
                    start_date_label.classList.add("popup-label");
                    const start_date = document.createElement("input");
                    start_date.id = "regist-start-date";
                    start_date.type = "datetime-local";
                    start_date.classList.add("popup-input");
                    start_date.setAttribute("name", "startDate");
                    start_date.setAttribute("autocomplete", "off");
                    start_date_div.appendChild(start_date_label);
                    start_date_div.appendChild(start_date);

                    // 옵션 적용 종료일
                    const end_date_div = document.createElement("div");
                    end_date_div.style.marginTop = "20px";
                    const end_date_label = document.createElement("div");
                    end_date_label.innerText = "옵션 적용 종료일";
                    end_date_label.classList.add("popup-label");
                    const end_date = document.createElement("input");
                    end_date.id = "regist-end-date";
                    end_date.type = "datetime-local";
                    end_date.classList.add("popup-input");
                    end_date.setAttribute("name", "endDate");
                    end_date.setAttribute("autocomplete", "off");
                    end_date_div.appendChild(end_date_label);
                    end_date_div.appendChild(end_date);

                    // 버튼
                    const submit_btn = document.createElement("div");
                    submit_btn.innerText = "완료";
                    submit_btn.classList.add("popup-button");
                    submit_btn.addEventListener("click", function(e) {
                        e.preventDefault();

                        // 하나씩 파싱해서 데이터 저장
                        const form = document.querySelector("#option-regist");
                        const option_name1 = form.querySelector("#regist-option-name1").value;
                        const option_name2 = form.querySelector("#regist-option-name2").value;
                        const option_cost = form.querySelector("#regist-option-cost").value;
                        const option_price = form.querySelector("#regist-option-price").value;
                        const image_path = form.querySelector("#regist-option-image-path").value;
                        const mock_filling = form.querySelector("#regist-option-mock-filling").value;
                        const mock_height = form.querySelector("#regist-option-mock-height").value;
                        const mock_width = form.querySelector("#regist-option-mock-width").value;
                        const mock_top = form.querySelector("#regist-option-mock-top").value;
                        const mock_left = form.querySelector("#regist-option-mock-left").value;
                        const mock_image_array = form.querySelector("#regist-option-mock-image-array").value.split(",");
                        const start_date = form.querySelector("#regist-start-date").value;
                        const end_date = form.querySelector("#regist-end-date").value;

                        var data = new FormData();

                        if(option_name1 !== "") {
                            data.append("optionName1", option_name1);
                        }
                        if(option_name2 !== "") {
                            data.append("optionName2", option_name2);
                        }
                        if(option_cost !== "") {
                            data.append("cost", option_cost);
                        }
                        if(option_price !== "") {
                            data.append("price", option_price);
                        }
                        if(image_path !== "") {
                            data.append("imagePath", image_path);
                        }
                        if(mock_filling !== "") {
                            data.append("mockFilling", mock_filling);
                        }
                        if(mock_height !== "") {
                            data.append("mockHeight", mock_height);
                        }
                        if(mock_width !== "") {
                            data.append("mockWidth", mock_width);
                        }
                        if(mock_top !== "") {
                            data.append("mockTop", mock_top);
                        }
                        if(mock_left !== "") {
                            data.append("mockLeft", mock_left);
                        }
                        if(typeof mock_image_array === "object") {
                            for(mock_image of mock_image_array) {
                                data.append("mockupImage", mock_image);
                            }
                        }
                        if(start_date !== "") {
                            data.append("startDate", moment(start_date).format("YYYYMMDDHHmmss").trim());
                        }
                        if(end_date !== "") {
                            data.append("endDate", moment(end_date).format("YYYYMMDDHHmmss").trim());
                        }
                        data.append("guideline", "-");
                        data.append("packageId", window.location.search.substring(1).split("=")[1]);
                        data.append("status", 'Y');

                        sendRegist(data);
                    });

                    // 데이터 전송
                    function sendRegist(data) {
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function(e) {
                            if (xhr.readyState == 4) {
                                if(xhr.status == 200) {
                                    const id = window.location.search.substring(1).split("=")[1];
                                    const result = JSON.parse(xhr.responseText);
                                    fetch(id);
                                    popup_regist.close();
                                    alert("등록에 성공하였습니다.");
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.value = "";
                                    mock_image_area.value = "";
                                    mock_image_effect.value = "";
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                } else {
                                    alert("등록에 실패하였습니다.");
                                }
                            }
                        }
                        xhr.open("POST", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/package/option", true);
                        xhr.send(data);
                    }

                    form.appendChild(option_name1_div);
                    form.appendChild(option_name2_div);
                    form.appendChild(cost_div);
                    form.appendChild(price_div);
                    form.appendChild(mock_image_base_div);
                    form.appendChild(mock_image_area_div);
                    form.appendChild(mock_image_effect_div);
                    form.appendChild(image_path_div);
                    form.appendChild(mock_image_array_div);
                    form.appendChild(mock_height_div);
                    form.appendChild(mock_width_div);
                    form.appendChild(mock_top_div);
                    form.appendChild(mock_left_div);
                    form.appendChild(mock_filling_div);
                    form.appendChild(start_date_div);
                    form.appendChild(end_date_div);
                    form.appendChild(submit_btn);

                    popup.appendChild(form);

                    // [서비스] 옵션 이미지 업로드
                    function optionImageUpload(data) {
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function(e) {
                            if (xhr.readyState == 4) {
                                if(xhr.status == 200) {
                                    const result = JSON.parse(xhr.responseText);
                                    // 값 등록
                                    image_path.value = result.result.imagePath;
                                    mock_image_array.value = result.result.fileNames.join();
                                    console.log(result);
                                    alert("업로드에 성공하였습니다.");
                                } else {
                                    const result = JSON.parse(xhr.responseText);
                                    alert("업로드에 실패하였습니다.\n" + result.message);
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.value = "";
                                    mock_image_area.value = "";
                                    mock_image_effect.value = "";
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                }
                            }
                        }
                        xhr.open("POST", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/upload/packageOptions", true);
                        xhr.send(data);
                    }
                });

                // [버튼] 등록
                document.querySelector("#option-regist-btn").addEventListener("click", function(e) {
                    e.preventDefault();
                    popup_regist.open();
                });

                // 수정 팝업
                const popup_editor = new Popup("옵션 수정");
                // 실제 팝업창에 그려질 form 문 작성
                popup_editor.setParam(new FormData());	// formData 생성
                popup_editor.init(function(popup) {
                    const form = document.createElement("form");
                    form.id = "option-editor";
                    form.style.display = "flex";
                    form.style.flexDirection = "column";
                    form.style.alignItems = "center";
                    form.style.padding = "0px 30px";

                    // 번호
                    const id_div = document.createElement("div");
                    id_div.style.marginTop = "45px";
                    const id_label = document.createElement("div");
                    id_label.innerText = "번호";
                    id_label.classList.add("popup-label");
                    const id = document.createElement("input");
                    id.id = "editor-option-id";
                    id.classList.add("popup-input");
                    id.setAttribute("name", "id");
                    id.setAttribute("autocomplete", "off");
                    id.readOnly = true;
                    id_div.appendChild(id_label);
                    id_div.appendChild(id);

                    // 옵션 이름1
                    const option_name1_div = document.createElement("div");
                    option_name1_div.style.marginTop = "20px";
                    const option_name1_label = document.createElement("div");
                    option_name1_label.innerText = "옵션 이름1";
                    option_name1_label.classList.add("popup-label");
                    const option_name1 = document.createElement("input");
                    option_name1.id = "editor-option-name1";
                    option_name1.classList.add("popup-input");
                    option_name1.setAttribute("name", "optionName1");
                    option_name1.setAttribute("autocomplete", "off");
                    option_name1_div.appendChild(option_name1_label);
                    option_name1_div.appendChild(option_name1);

                    // 옵션 이름2
                    const option_name2_div = document.createElement("div");
                    option_name2_div.style.marginTop = "20px";
                    const option_name2_label = document.createElement("div");
                    option_name2_label.innerText = "옵션 이름2";
                    option_name2_label.classList.add("popup-label");
                    const option_name2 = document.createElement("input");
                    option_name2.id = "editor-option-name2";
                    option_name2.classList.add("popup-input");
                    option_name2.setAttribute("name", "optionName2");
                    option_name2.setAttribute("autocomplete", "off");
                    option_name2_div.appendChild(option_name2_label);
                    option_name2_div.appendChild(option_name2);

                    // 비용
                    const cost_div = document.createElement("div");
                    cost_div.style.marginTop = "20px";
                    const cost_label = document.createElement("div");
                    cost_label.innerText = "비용";
                    cost_label.classList.add("popup-label");
                    const cost = document.createElement("input");
                    cost.id = "editor-option-cost";
                    cost.classList.add("popup-input");
                    cost.setAttribute("name", "cost");
                    cost.setAttribute("autocomplete", "off");
                    cost_div.appendChild(cost_label);
                    cost_div.appendChild(cost);

                    // 가격
                    const price_div = document.createElement("div");
                    price_div.style.marginTop = "20px";
                    const price_label = document.createElement("div");
                    price_label.innerText = "가격";
                    price_label.classList.add("popup-label");
                    const price = document.createElement("input");
                    price.id = "editor-option-price";
                    price.classList.add("popup-input");
                    price.setAttribute("name", "price");
                    price.setAttribute("autocomplete", "off");
                    price_div.appendChild(price_label);
                    price_div.appendChild(price);

                    // mock 이미지 base
                    const mock_image_base_div = document.createElement("div");
                    mock_image_base_div.style.marginTop = "20px";
                    const mock_image_base_label = document.createElement("div");
                    mock_image_base_label.innerText = "MOCK 기본 이미지(?.png)";
                    mock_image_base_label.classList.add("popup-label");
                    const mock_image_base = document.createElement("input");
                    mock_image_base.type = "file";
                    mock_image_base.id = "editor-option-mock-image-base";
                    mock_image_base.classList.add("popup-input");
                    mock_image_base.setAttribute("name", "images");
                    mock_image_base.setAttribute("autocomplete", "off");
                    mock_image_base.addEventListener("change", function(e) {
                        const reader = new FileReader();
                        let filename = typeof e.target.files[0] === "object" ? e.target.files[0].name : "new_file.png";
                        // 영역
                        if(filename.indexOf("_area") > -1) {
                            filename = filename.substring(0, filename.indexOf("_area")) + filename.substring(filename.indexOf("_area") + "_area".length, filename.length);
                        }
                        // 효과
                        if(filename.indexOf("_effect") > -1) {
                            filename = filename.substring(0, filename.indexOf("_effect")) + filename.substring(filename.indexOf("_effect") + "_effect".length, filename.length);
                        }
                        reader.onload = function(event) {
                            mock_image_base.setAttribute("disabled", true);
                            const result = event.target.result;
                            const blob_bin = window.atob(result.split(',')[1]);	// base64 데이터 디코딩
                            const array = [];
                            for (let i = 0; i < blob_bin.length; i++) {
                                array.push(blob_bin.charCodeAt(i));
                            }
                            const blob = new Blob([new Uint8Array(array)], {type: 'image/png'});	// Blob 생성
                            popup_regist.getParam().append("images", blob, filename);	            // file data 추가

                            // 사이즈
                            var size = 0;
                            for(let pair of popup_regist.getParam().entries()) { size++; }
                            if(size == 3) {
                                if(confirm("정말 업로드를 진행하시겠습니다.")) {
                                    optionImageUpload(popup_regist.getParam());
                                } else {
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                }
                            }
                        }
                        reader.readAsDataURL(e.target.files[0]);
                    });
                    mock_image_base_div.appendChild(mock_image_base_label);
                    mock_image_base_div.appendChild(mock_image_base);

                    // mock 이미지 area
                    const mock_image_area_div = document.createElement("div");
                    mock_image_area_div.style.marginTop = "20px";
                    const mock_image_area_label = document.createElement("div");
                    mock_image_area_label.innerText = "MOCK 범위 이미지(?_area.png)";
                    mock_image_area_label.classList.add("popup-label");
                    const mock_image_area = document.createElement("input");
                    mock_image_area.type = "file";
                    mock_image_area.id = "editor-option-mock-image-area";
                    mock_image_area.classList.add("popup-input");
                    mock_image_area.setAttribute("name", "images");
                    mock_image_area.setAttribute("autocomplete", "off");
                    mock_image_area.addEventListener("change", function(e) {
                        const reader = new FileReader();
                        let filename = typeof e.target.files[0] === "object" ? e.target.files[0].name : "new_file.png";
                        // 효과
                        if(filename.indexOf("_effect") > -1) {
                            filename = filename.substring(0, filename.indexOf("_effect")) + filename.substring(filename.indexOf("_effect") + "_effect".length, filename.length);
                        }
                        // 영역
                        if(filename.indexOf("_area") == -1) {
                            filename = filename.substring(0, filename.indexOf(".")) + "_area" + filename.substring(filename.indexOf("."), filename.length);
                        }
                        reader.onload = function(event) {
                            mock_image_area.setAttribute("disabled", true);
                            const result = event.target.result;
                            const blob_bin = window.atob(result.split(',')[1]);	// base64 데이터 디코딩
                            const array = [];
                            for (let i = 0; i < blob_bin.length; i++) {
                                array.push(blob_bin.charCodeAt(i));
                            }
                            const blob = new Blob([new Uint8Array(array)], {type: 'image/png'});	// Blob 생성
                            popup_regist.getParam().append("images", blob, filename);	            // file data 추가

                            // 사이즈
                            var size = 0;
                            for(let pair of popup_regist.getParam().entries()) { size++; }
                            if(size == 3) {
                                if(confirm("정말 업로드를 진행하시겠습니다.")) {
                                    optionImageUpload(popup_regist.getParam());
                                } else {
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                }
                            }
                        }
                        reader.readAsDataURL(e.target.files[0]);
                    });
                    mock_image_area_div.appendChild(mock_image_area_label);
                    mock_image_area_div.appendChild(mock_image_area);

                    // mock 이미지 effect
                    const mock_image_effect_div = document.createElement("div");
                    mock_image_effect_div.style.marginTop = "20px";
                    const mock_image_effect_label = document.createElement("div");
                    mock_image_effect_label.innerText = "MOCK 효과 이미지(?_effect.png)";
                    mock_image_effect_label.classList.add("popup-label");
                    const mock_image_effect = document.createElement("input");
                    mock_image_effect.type = "file";
                    mock_image_effect.id = "editor-option-mock-image-effect";
                    mock_image_effect.classList.add("popup-input");
                    mock_image_effect.setAttribute("name", "images");
                    mock_image_effect.setAttribute("autocomplete", "off");
                    mock_image_effect.addEventListener("change", function(e) {
                        const reader = new FileReader();
                        let filename = typeof e.target.files[0] === "object" ? e.target.files[0].name : "new_file.png";
                        // 영역
                        if(filename.indexOf("_area") > -1) {
                            filename = filename.substring(0, filename.indexOf("_area")) + filename.substring(filename.indexOf("_area") + "_area".length, filename.length);
                        }
                        // 효과
                        if(filename.indexOf("_effect") == -1) {
                            filename = filename.substring(0, filename.indexOf(".")) + "_effect" + filename.substring(filename.indexOf("."), filename.length);
                        }
                        reader.onload = function(event) {
                            mock_image_effect.setAttribute("disabled", true);
                            const result = event.target.result;
                            const blob_bin = window.atob(result.split(',')[1]);	// base64 데이터 디코딩
                            const array = [];
                            for (let i = 0; i < blob_bin.length; i++) {
                                array.push(blob_bin.charCodeAt(i));
                            }
                            const blob = new Blob([new Uint8Array(array)], {type: 'image/png'});	// Blob 생성
                            popup_regist.getParam().append("images", blob, filename);	            // file data 추가
                            
                            // 사이즈
                            var size = 0;
                            for(let pair of popup_regist.getParam().entries()) { size++; }
                            if(size == 3) {
                                if(confirm("정말 업로드를 진행하시겠습니다.")) {
                                    optionImageUpload(popup_regist.getParam());
                                } else {
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.value = "";
                                    mock_image_area.value = "";
                                    mock_image_effect.value = "";
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                }
                            }
                        }
                        reader.readAsDataURL(e.target.files[0]);
                    });
                    mock_image_effect_div.appendChild(mock_image_effect_label);
                    mock_image_effect_div.appendChild(mock_image_effect);

                    // 이미지 위치
                    const image_path_div = document.createElement("div");
                    image_path_div.style.marginTop = "20px";
                    const image_path_label = document.createElement("div");
                    image_path_label.innerText = "[자동입력]이미지 위치";
                    image_path_label.classList.add("popup-label");
                    const image_path = document.createElement("input");
                    image_path.id = "editor-option-image-path";
                    image_path.classList.add("popup-input");
                    image_path.setAttribute("name", "imagePath");
                    image_path.setAttribute("autocomplete", "off");
                    image_path.setAttribute("readonly", true);
                    image_path_div.appendChild(image_path_label);
                    image_path_div.appendChild(image_path);

                    // mock 이미지 배열
                    const mock_image_array_div = document.createElement("div");
                    mock_image_array_div.style.marginTop = "20px";
                    const mock_image_array_label = document.createElement("div");
                    mock_image_array_label.innerText = "[자동입력]MOCK 파일 리스트";
                    mock_image_array_label.classList.add("popup-label");
                    const mock_image_array = document.createElement("input");
                    mock_image_array.id = "editor-option-mock-image-array";
                    mock_image_array.classList.add("popup-input");
                    mock_image_array.setAttribute("name", "mockupImage");
                    mock_image_array.setAttribute("autocomplete", "off");
                    mock_image_array.setAttribute("readonly", true);
                    mock_image_array_div.appendChild(mock_image_array_label);
                    mock_image_array_div.appendChild(mock_image_array);

                    // mock 높이
                    const mock_height_div = document.createElement("div");
                    mock_height_div.style.marginTop = "20px";
                    const mock_height_label = document.createElement("div");
                    mock_height_label.innerText = "에셋 높이";
                    mock_height_label.classList.add("popup-label");
                    const mock_height = document.createElement("input");
                    mock_height.id = "editor-option-mock-height";
                    mock_height.classList.add("popup-input");
                    mock_height.setAttribute("name", "mockHeight");
                    mock_height.setAttribute("autocomplete", "off");
                    mock_height.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_height.addEventListener("paste", function(e) {
                        this.value = "";
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#editor-option-mock-height").value = option_data.height;
                                document.querySelector("#editor-option-mock-width").value = option_data.width;
                                document.querySelector("#editor-option-mock-top").value = option_data.top;
                                document.querySelector("#editor-option-mock-left").value = option_data.left;
                                document.querySelector("#editor-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_height_div.appendChild(mock_height_label);
                    mock_height_div.appendChild(mock_height);

                    // mock 길이
                    const mock_width_div = document.createElement("div");
                    mock_width_div.style.marginTop = "20px";
                    const mock_width_label = document.createElement("div");
                    mock_width_label.innerText = "에셋 길이";
                    mock_width_label.classList.add("popup-label");
                    const mock_width = document.createElement("input");
                    mock_width.id = "editor-option-mock-width";
                    mock_width.classList.add("popup-input");
                    mock_width.setAttribute("name", "mockWidth");
                    mock_width.setAttribute("autocomplete", "off");
                    mock_width.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_width.addEventListener("paste", function(e) {
                        this.value = "";
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#editor-option-mock-height").value = option_data.height;
                                document.querySelector("#editor-option-mock-width").value = option_data.width;
                                document.querySelector("#editor-option-mock-top").value = option_data.top;
                                document.querySelector("#editor-option-mock-left").value = option_data.left;
                                document.querySelector("#editor-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_width_div.appendChild(mock_width_label);
                    mock_width_div.appendChild(mock_width);

                    // mock 위치 TOP
                    const mock_top_div = document.createElement("div");
                    mock_top_div.style.marginTop = "20px";
                    const mock_top_label = document.createElement("div");
                    mock_top_label.innerText = "에셋 위치 TOP";
                    mock_top_label.classList.add("popup-label");
                    const mock_top = document.createElement("input");
                    mock_top.id = "editor-option-mock-top";
                    mock_top.classList.add("popup-input");
                    mock_top.setAttribute("name", "mockTop");
                    mock_top.setAttribute("autocomplete", "off");
                    mock_top.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_top.addEventListener("paste", function(e) {
                        this.value = "";
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#editor-option-mock-height").value = option_data.height;
                                document.querySelector("#editor-option-mock-width").value = option_data.width;
                                document.querySelector("#editor-option-mock-top").value = option_data.top;
                                document.querySelector("#editor-option-mock-left").value = option_data.left;
                                document.querySelector("#editor-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_top_div.appendChild(mock_top_label);
                    mock_top_div.appendChild(mock_top);

                    // mock 위치 LEFT
                    const mock_left_div = document.createElement("div");
                    mock_left_div.style.marginTop = "20px";
                    const mock_left_label = document.createElement("div");
                    mock_left_label.innerText = "에셋 위치 LEFT";
                    mock_left_label.classList.add("popup-label");
                    const mock_left = document.createElement("input");
                    mock_left.id = "editor-option-mock-left";
                    mock_left.classList.add("popup-input");
                    mock_left.setAttribute("name", "mockLeft");
                    mock_left.setAttribute("autocomplete", "off");
                    mock_left.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_left.addEventListener("paste", function(e) {
                        this.value = "";
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#editor-option-mock-height").value = option_data.height;
                                document.querySelector("#editor-option-mock-width").value = option_data.width;
                                document.querySelector("#editor-option-mock-top").value = option_data.top;
                                document.querySelector("#editor-option-mock-left").value = option_data.left;
                                document.querySelector("#editor-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_left_div.appendChild(mock_left_label);
                    mock_left_div.appendChild(mock_left);

                    // mock 배경색
                    const mock_filling_div = document.createElement("div");
                    mock_filling_div.style.marginTop = "20px";
                    const mock_filling_label = document.createElement("div");
                    mock_filling_label.innerText = "에셋 배경색";
                    mock_filling_label.classList.add("popup-label");
                    const mock_filling = document.createElement("input");
                    mock_filling.id = "editor-option-mock-filling";
                    mock_filling.classList.add("popup-input");
                    mock_filling.setAttribute("name", "mockFilling");
                    mock_filling.setAttribute("autocomplete", "off");
                    mock_filling.setAttribute("placeholder", "iOS(cmd + v) / Win(ctrl + v)");
                    mock_filling.addEventListener("paste", function(e) {
                        this.value = "";
                        setTimeout(function() {
                            try {
                                const option_data = JSON.parse(e.target.value);
                                document.querySelector("#editor-option-mock-height").value = option_data.height;
                                document.querySelector("#editor-option-mock-width").value = option_data.width;
                                document.querySelector("#editor-option-mock-top").value = option_data.top;
                                document.querySelector("#editor-option-mock-left").value = option_data.left;
                                document.querySelector("#editor-option-mock-filling").value = option_data.color;
                            } catch(e) {
                                // console.log(e);
                            }
                        }, 0);
                    });
                    mock_filling_div.appendChild(mock_filling_label);
                    mock_filling_div.appendChild(mock_filling);

                    // 옵션 적용 시작일
                    // const start_date_div = document.createElement("div");
                    // start_date_div.style.marginTop = "20px";
                    // const start_date_label = document.createElement("div");
                    // start_date_label.innerText = "옵션 적용 시작일 : ";
                    // start_date_label.style.width = "200px";
                    // start_date_label.style.fontWeight = "bold";
                    // const start_date = document.createElement("input");
                    // start_date.id = "editor-start-date";
                    // start_date.type = "datetime-local";
                    // start_date.style.padding = "5px";
                    // start_date.style.fontSize = "15px";
                    // start_date.style.width = "288px";
                    // start_date.setAttribute("name", "startDate");
                    // start_date_div.appendChild(start_date_label);
                    // start_date_div.appendChild(start_date);

                    // 옵션 적용 종료일
                    // const end_date_div = document.createElement("div");
                    // end_date_div.style.marginTop = "20px";
                    // const end_date_label = document.createElement("div");
                    // end_date_label.innerText = "옵션 적용 종료일 : ";
                    // end_date_label.style.width = "200px";
                    // end_date_label.style.fontWeight = "bold";
                    // const end_date = document.createElement("input");
                    // end_date.id = "editor-end-date";
                    // end_date.type = "datetime-local";
                    // end_date.style.padding = "5px";
                    // end_date.style.fontSize = "15px";
                    // end_date.style.width = "288px";
                    // end_date.setAttribute("name", "endDate");
                    // end_date_div.appendChild(end_date_label);
                    // end_date_div.appendChild(end_date);

                    // 상태
                    const status_div = document.createElement("div");
                    status_div.style.marginTop = "20px";
                    const status_label = document.createElement("div");
                    status_label.innerText = "사용여부(Y, N) : ";
                    status_label.classList.add("popup-label");
                    const status = document.createElement("input");
                    status.id = "editor-option-status";
                    status.classList.add("popup-input");
                    status.setAttribute("name", "status");
                    status.setAttribute("autocomplete", "off");
                    status_div.appendChild(status_label);
                    status_div.appendChild(status);

                    // 버튼
                    const submit_btn = document.createElement("div");
                    submit_btn.innerText = "완료";
                    submit_btn.classList.add("popup-button");
                    submit_btn.addEventListener("click", function(e) {
                        e.preventDefault();

                        // 하나씩 파싱해서 데이터 저장
                        const form = document.querySelector("#option-editor");
                        const option_id = form.querySelector("#editor-option-id").value;
                        const option_name1 = form.querySelector("#editor-option-name1").value;
                        const option_name2 = form.querySelector("#editor-option-name2").value;
                        const option_cost = form.querySelector("#editor-option-cost").value;
                        const option_price = form.querySelector("#editor-option-price").value;
                        const image_path = form.querySelector("#editor-option-image-path").value;
                        const mock_filling = form.querySelector("#editor-option-mock-filling").value;
                        const mock_height = form.querySelector("#editor-option-mock-height").value;
                        const mock_width = form.querySelector("#editor-option-mock-width").value;
                        const mock_top = form.querySelector("#editor-option-mock-top").value;
                        const mock_left = form.querySelector("#editor-option-mock-left").value;
                        const mock_image_array = form.querySelector("#editor-option-mock-image-array").value.split(",");
                        // const start_date = form.querySelector("#editor-start-date").value;
                        // const end_date = form.querySelector("#editor-end-date").value;
                        const option_status = form.querySelector("#editor-option-status").value;

                        var data = new FormData();

                        if(option_id !== "") {
                            data.append("id", option_id);
                        }
                        if(option_name1 !== "") {
                            data.append("optionName1", option_name1);
                        }
                        if(option_name2 !== "") {
                            data.append("optionName2", option_name2);
                        }
                        if(option_cost !== "") {
                            data.append("cost", option_cost);
                        }
                        if(option_price !== "") {
                            data.append("price", option_price);
                        }
                        if(image_path !== "") {
                            data.append("imagePath", image_path);
                        }
                        if(mock_filling !== "") {
                            data.append("mockFilling", mock_filling);
                        }
                        if(mock_height !== "") {
                            data.append("mockHeight", mock_height);
                        }
                        if(mock_width !== "") {
                            data.append("mockWidth", mock_width);
                        }
                        if(mock_top !== "") {
                            data.append("mockTop", mock_top);
                        }
                        if(mock_left !== "") {
                            data.append("mockLeft", mock_left);
                        }
                        if(typeof mock_image_array === "object") {
                            for(mock_image of mock_image_array) {
                                data.append("mockupImage", mock_image);
                            }
                        }
                        // if(start_date !== "") {
                        //     data.append("startDate", moment(start_date).format("YYYYMMDDHHmmss").trim());
                        // }
                        // if(end_date !== "") {
                        //     data.append("endDate", moment(end_date).format("YYYYMMDDHHmmss").trim());
                        // }
                        if(option_status !== "") {
                            data.append("status", option_status);
                        }
                        // data.append("packageId", window.location.search.substring(1).split("=")[1]);

                        sendEditor(data);
                    });

                    // 데이터 전송
                    function sendEditor(data) {
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function(e) {
                            if (xhr.readyState == 4) {
                                if(xhr.status == 200) {
                                    const id = window.location.search.substring(1).split("=")[1];
                                    const result = JSON.parse(xhr.responseText);
                                    fetch(id);
                                    popup_editor.close();
                                    alert("수정에 성공하였습니다.");
                                    popup_editor.setParam(new FormData());
                                    mock_image_base.value = "";
                                    mock_image_area.value = "";
                                    mock_image_effect.value = "";
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                } else {
                                    alert("수정에 실패하였습니다.");
                                }
                            }
                        }
                        xhr.open("PUT", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/package/option", true);
                        xhr.send(data);
                    }

                    form.appendChild(id_div);
                    form.appendChild(option_name1_div);
                    form.appendChild(option_name2_div);
                    form.appendChild(cost_div);
                    form.appendChild(price_div);
                    form.appendChild(mock_image_base_div);
                    form.appendChild(mock_image_area_div);
                    form.appendChild(mock_image_effect_div);
                    form.appendChild(image_path_div);
                    form.appendChild(mock_image_array_div);
                    form.appendChild(mock_height_div);
                    form.appendChild(mock_width_div);
                    form.appendChild(mock_top_div);
                    form.appendChild(mock_left_div);
                    form.appendChild(mock_filling_div);
                    // form.appendChild(start_date_div);
                    // form.appendChild(end_date_div);
                    form.appendChild(status_div);
                    form.appendChild(submit_btn);

                    popup.appendChild(form);

                    // [서비스] 옵션 이미지 업로드
                    function optionImageUpload(data) {
                        var xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function(e) {
                            if (xhr.readyState == 4) {
                                if(xhr.status == 200) {
                                    const result = JSON.parse(xhr.responseText);
                                    // 값 등록
                                    image_path.value = result.result.imagePath;
                                    mock_image_array.value = result.result.fileNames.join();
                                    console.log(result);
                                    alert("업로드에 성공하였습니다.");
                                } else {
                                    const result = JSON.parse(xhr.responseText);
                                    alert("업로드에 실패하였습니다.\n" + result.message);
                                    popup_regist.setParam(new FormData());
                                    mock_image_base.value = "";
                                    mock_image_area.value = "";
                                    mock_image_effect.value = "";
                                    mock_image_base.removeAttribute("disabled");
                                    mock_image_area.removeAttribute("disabled");
                                    mock_image_effect.removeAttribute("disabled");
                                }
                            }
                        }
                        xhr.open("POST", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/upload/packageOptions", true);
                        xhr.send(data);
                    }
                });

                // 가격 수정
                const popup_editor_price = new Popup("가격 수정");
                // 실제 팝업창에 그려질 form 문 작성
                popup_editor_price.init(function(popup) {
                    const form = document.createElement("form");
                    form.id = "price-editor";
                    form.style.display = "flex";
                    form.style.flexDirection = "column";
                    form.style.alignItems = "center";
                    form.style.padding = "0px 30px";

                    // 번호
                    const id_div = document.createElement("div");
                    id_div.style.marginTop = "45px";
                    const id_label = document.createElement("div");
                    id_label.innerText = "번호(패키지)";
                    id_label.classList.add("popup-label");
                    const id = document.createElement("input");
                    id.id = "editor-package-id";
                    id.classList.add("popup-input");
                    id.setAttribute("name", "packageId");
                    id.setAttribute("autocomplete", "off");
                    id.setAttribute("readonly", true);
                    id_div.appendChild(id_label);
                    id_div.appendChild(id);

                    // 비용
                    const price_cost_div = document.createElement("div");
                    price_cost_div.style.marginTop = "20px";
                    const price_cost_label = document.createElement("div");
                    price_cost_label.innerText = "비용";
                    price_cost_label.classList.add("popup-label");
                    const price_cost = document.createElement("input");
                    price_cost.id = "editor-price-cost";
                    price_cost.classList.add("popup-input");
                    price_cost.setAttribute("name", "cost");
                    price_cost.setAttribute("autocomplete", "off");
                    price_cost_div.appendChild(price_cost_label);
                    price_cost_div.appendChild(price_cost);

                    // 가격
                    const price_div = document.createElement("div");
                    price_div.style.marginTop = "20px";
                    const price_label = document.createElement("div");
                    price_label.innerText = "가격";
                    price_label.classList.add("popup-label");
                    const price = document.createElement("input");
                    price.id = "editor-package-price";
                    price.classList.add("popup-input");
                    price.setAttribute("name", "price");
                    price.setAttribute("autocomplete", "off");
                    price_div.appendChild(price_label);
                    price_div.appendChild(price);

                    // 배송비
                    const price_delivery_charge_div = document.createElement("div");
                    price_delivery_charge_div.style.marginTop = "20px";
                    const price_delivery_charge_label = document.createElement("div");
                    price_delivery_charge_label.innerText = "배송비";
                    price_delivery_charge_label.classList.add("popup-label");
                    const price_delivery_charge = document.createElement("input");
                    price_delivery_charge.id = "editor-price-delivery-charge";
                    price_delivery_charge.classList.add("popup-input");
                    price_delivery_charge.setAttribute("name", "deliveryCharge");
                    price_delivery_charge.setAttribute("autocomplete", "off");
                    price_delivery_charge_div.appendChild(price_delivery_charge_label);
                    price_delivery_charge_div.appendChild(price_delivery_charge);

                    // 추가 배송비
                    const price_delivery_extra_charge_div = document.createElement("div");
                    price_delivery_extra_charge_div.style.marginTop = "20px";
                    const price_delivery_extra_charge_label = document.createElement("div");
                    price_delivery_extra_charge_label.innerText = "추가 배송비";
                    price_delivery_extra_charge_label.classList.add("popup-label");
                    const price_delivery_extra_charge = document.createElement("input");
                    price_delivery_extra_charge.id = "editor-price-delivery-extra-charge";
                    price_delivery_extra_charge.classList.add("popup-input");
                    price_delivery_extra_charge.setAttribute("name", "deliveryExtraCharge");
                    price_delivery_extra_charge.setAttribute("autocomplete", "off");
                    price_delivery_extra_charge_div.appendChild(price_delivery_extra_charge_label);
                    price_delivery_extra_charge_div.appendChild(price_delivery_extra_charge);

                    // 가격 시작일
                    // const start_date_div = document.createElement("div");
                    // start_date_div.style.marginTop = "20px";
                    // const start_date_label = document.createElement("div");
                    // start_date_label.innerText = "가격 시작일";
                    // start_date_label.classList.add("popup-label");
                    // const start_date = document.createElement("input");
                    // start_date.id = "editor-start-date";
                    // start_date.type = "datetime-local";
                    // start_date.classList.add("popup-input");
                    // start_date.setAttribute("name", "startDate");
                    // start_date.setAttribute("autocomplete", "off");
                    // start_date_div.appendChild(start_date_label);
                    // start_date_div.appendChild(start_date);

                    // 가격 종료일
                    const end_date_div = document.createElement("div");
                    end_date_div.style.marginTop = "20px";
                    const end_date_label = document.createElement("div");
                    end_date_label.innerText = "가격 종료일";
                    end_date_label.classList.add("popup-label");
                    const end_date = document.createElement("input");
                    end_date.id = "editor-end-date";
                    end_date.type = "datetime-local";
                    end_date.classList.add("popup-input");
                    end_date.setAttribute("name", "endDate");
                    end_date.setAttribute("autocomplete", "off");
                    end_date_div.appendChild(end_date_label);
                    end_date_div.appendChild(end_date);

                    // 버튼
                    const submit_btn = document.createElement("div");
                    submit_btn.innerText = "완료";
                    submit_btn.classList.add("popup-button");
                    submit_btn.addEventListener("click", function(e) {
                        e.preventDefault();

                        const form = document.querySelector("#price-editor");
                        const package_id = form.querySelector("#editor-package-id").value;
                        const price_cost = form.querySelector("#editor-price-cost").value;
                        const package_price = form.querySelector("#editor-package-price").value;
                        const price_delivery_charge = form.querySelector("#editor-price-delivery-charge").value;
                        const price_delivery_extra_charge = form.querySelector("#editor-price-delivery-extra-charge").value;
                        // const start_date = form.querySelector("#editor-start-date").value;
                        const end_date = form.querySelector("#editor-end-date").value;
                        
                        var data = new FormData();

                        if(package_id !== "") {
                            data.append("packageId", package_id);
                        }
                        if(price_cost !== "") {
                            data.append("cost", price_cost);
                        }
                        if(package_price !== "") {
                            data.append("price", package_price);
                        }
                        if(price_delivery_charge !== "") {
                            data.append("deliveryCharge", price_delivery_charge);
                        }
                        if(price_delivery_extra_charge !== "") {
                            data.append("deliveryExtraCharge", price_delivery_extra_charge);
                        }
                        // if(start_date !== "") {
                        //     data.append("startDate", moment(start_date).format("YYYYMMDDHHmmss").trim());
                        // }
                        if(end_date !== "") {
                            data.append("endDate", moment(end_date).format("YYYYMMDDHHmmss").trim());
                        }

                        sendPrice(data);
                    });

                    form.appendChild(id_div);
                    form.appendChild(price_cost_div);
                    form.appendChild(price_div);
                    form.appendChild(price_delivery_charge_div);
                    form.appendChild(price_delivery_extra_charge_div);
                    // form.appendChild(start_date_div);
                    form.appendChild(end_date_div);
                    form.appendChild(submit_btn);

                    popup.appendChild(form);
                });

                // 데이터 전송
                function sendPrice(data) {
                    var xhr_ = new XMLHttpRequest();
                    xhr_.onreadystatechange = function(e) {
                        if (xhr_.readyState == 4) {
                            if (xhr_.status == 200) {
                                const result = JSON.parse(xhr_.responseText);
                                const data = result.result;
                                parsing(data);
                                popup_editor_price.close();
                                alert("가격 수정에 성공하였습니다.");
                            } else {
                                alert("가격 수정에 실패하였습니다.");
                            }
                        }
                    }
                    xhr_.open("PUT", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/package/price", true);
                    xhr_.send(data);
                }

                // [버튼] 가격 수정
                document.querySelector("#price-update-btn").addEventListener("click", function(e) {
                    // 아이디를 통해 크리에이터 정보 조회
                    const id = window.location.search.substring(1).split("=")[1];
                    fetchPrice(id);
                    popup_editor_price.open();
                });

                // 가격 데이터 획득
                function fetchPrice(id) {
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function(e) {
                        if (xhr.readyState == 4) {
                            if (xhr.status == 200) {
                                const result = JSON.parse(xhr.responseText);
                                const data = result.result.packagePrice;

                                const form = document.querySelector("#price-editor");
                                form.querySelector("#editor-package-id").value = data.packageId;
                                form.querySelector("#editor-price-cost").value = data.cost;
                                form.querySelector("#editor-package-price").value = data.price;
                                form.querySelector("#editor-price-delivery-charge").value = data.deliveryCharge;
                                form.querySelector("#editor-price-delivery-extra-charge").value = data.deliveryExtraCharge;
                                // form.querySelector("#editor-start-date").value = moment(data.startDate).format("YYYY-MM-DDThh:mm:ss.SSS");
                                form.querySelector("#editor-end-date").value = moment(data.endDate).format("YYYY-MM-DDThh:mm:ss.SSS");
                            } else {
                                console.log("xhr error");
                            }
                        }
                    }
                    xhr.open("GET", "http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/package/" + id, true);
                    xhr.send();
                }
            }
        </script>
    </head>
    <body class="ac">
        <div class="wrapper">
            <div class="head">
                Auto Cropper
            </div>
            <div class="menu">
                <div class="logo">
                    <img src="./img/ac-logo.png">
                </div>
                <div class="platform">
                    <img src="./img/ac-platform.png">
                </div>
                <div class="menu-item" data-page="creator">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-creator.png">
                    </div>
                    <div class="menu-item-text">
                        Creator
                    </div>
                </div>
                <div class="menu-item" data-page="maker">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-maker.png">
                    </div>
                    <div class="menu-item-text">
                        Maker
                    </div>
                </div>
                <div class="menu-item active" data-page="package">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-package-active.png">
                    </div>
                    <div class="menu-item-text">
                        Package
                    </div>
                </div>
                <div class="menu-item" data-page="edit">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-edit.png">
                    </div>
                    <div class="menu-item-text">
                        Edit
                    </div>
                </div>
                <div class="menu-item" data-page="auto">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-auto.png">
                    </div>
                    <div class="menu-item-text">
                        Auto
                    </div>
                </div>
                <div class="menu-item" data-page="product">
                    <div class="menu-item-icon">
                        <img src="./img/menu-icon-product.png">
                    </div>
                    <div class="menu-item-text">
                        Product
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="info">
                    <div class="package">
                        <!-- <div id="package-thumbnail" class="thumbnail"></div> -->
                        <div class="package-data">
                            <div id="package-creator" class="creator"></div>
                            <div id="package-name" class="name"></div>
                        </div>
                        <div class="price">
                            <div>
                                <span style="float: left; margin-right: 10px;">비용 </span>
                                <span id="package-cost"></span>
                            </div>
                            <div>
                                <span style="float: left; margin-right: 10px;">가격 </span>
                                <span id="package-price"></span>
                            </div>
                        </div>
                    </div>
                    <div class="update">
                        <div id="price-update-btn" class="price-update-btn"></div>
                    </div>
                    <div class="upload">
                        <div id="option-regist-btn" class="option-regist-btn">옵션 등록</div>
                    </div>
                </div>
                <div class="data">
                    <div id="option-list" class="option-list editor">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>