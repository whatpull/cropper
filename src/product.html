<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Auto Cropper</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
        <link href="./css/common.css" rel="stylesheet" />
        <link href="./subproject/css/product.css" rel="stylesheet" />

        <!-- 공통 -->
        <script type="text/javascript" src="./js/common.js"></script>

        <!-- 셀렉트박스 모듈 -->
        <!-- <script type="text/javascript" src="./js/selectbox_core_module.js"></script>
        <link rel="stylesheet" type="text/css" href="./css/selectbox.css" /> -->

        <!-- 테이블 모듈 -->
        <script type="text/javascript" src="./js/table_core_module.js"></script>
        <link href="./css/table.css" rel="stylesheet" />

        <script>
            window.onload = function() {
                common.menu();
                common.expander();

                // const table = new Table("data/creator.json");
                const table = new Table("http://ec2-52-79-159-121.ap-northeast-2.compute.amazonaws.com:8080/api/products");
                table.body("page=0", bodydata, "status=ENABLED");

                // 테이블 바디설정 태그
                function bodydata(item, target) {
                    // DIV ROW 생성
                    const row = document.createElement("div");
                    row.classList.add("ac-table-row");

                    // DIV COLUM 생성, 데이터를 어떻게 파싱할지
                    const column_01 = document.createElement("div");
                    column_01.id = "ac-product-number";
                    column_01.style.width = "80px";
                    column_01.innerText = item.id;
                    column_01.classList.add("ac-table-column");
                    
                    const column_02 = document.createElement("div");
                    column_02.id = "ac-product-name";
                    column_02.style.width = "150px";
                    column_02.innerText = item.name;
                    column_02.classList.add("ac-table-column");

                    const column_03 = document.createElement("div");
                    column_03.id = "ac-creator-name";
                    column_03.style.width = "150px";
                    column_03.innerText = item.creatorName;
                    column_03.classList.add("ac-table-column");

                    const column_04 = document.createElement("div");
                    column_04.id = "ac-product-status";
                    column_04.style.width = "150px";
                    column_04.innerText = item.status;
                    column_04.classList.add("ac-table-column");

                    const column_05 = document.createElement("div");
                    column_05.id = "ac-package-creator-name";
                    column_05.style.width = "150px";
                    column_05.innerText = item.packageCreatorName;
                    column_05.classList.add("ac-table-column");

                    const btn_download = document.createElement("div");
                    btn_download.id = "ac-btn-download";
                    btn_download.style.marginRight = "10px";
                    btn_download.setAttribute("data-url", item.productImagePath);
                    btn_download.innerText = "다운로드";
                    btn_download.classList.add("ac-table-btn-download");
                    btn_download.addEventListener("click", function(e) {
                        e.preventDefault();
                        // 파일 다운로드 구현
                        const url = this.getAttribute("data-url");
                        var link = document.createElement('a');
                        link.style.width = "0px";
                        link.style.height = "0px";
                        link.style.visibility = "hidden";
                        link.href = url;
                        link.download = 'product_image.png';
                        // 이벤트 루프 방지용(클릭시 이벤트 전파를 막습니다.)
                        link.addEventListener("click", function(e) {
                            e.stopPropagation();
                        });
                        this.appendChild(link);
                        link.click();
                        this.removeChild(link);
                    });

                    const btn_detail = document.createElement("div");
                    btn_detail.id = "ac-btn-detail";
                    btn_detail.setAttribute("data-id", item.id);
                    btn_detail.innerText = "상세";
                    btn_detail.classList.add("ac-table-btn-detail");
                    btn_detail.addEventListener("click", function(e) {
                        e.preventDefault();
                        window.location.href = "product_detail.html?id=" + this.getAttribute("data-id");
                    });

                    const column_06 = document.createElement("div");
                    column_06.id = "ac-creator-setting";
                    column_06.style.width = "250px";
                    column_06.classList.add("ac-table-column");
                    column_06.appendChild(btn_download);
                    column_06.appendChild(btn_detail);

                    row.appendChild(column_01);
                    row.appendChild(column_02);
                    row.appendChild(column_03);
                    row.appendChild(column_04);
                    row.appendChild(column_05);
                    row.appendChild(column_06);

                    target.appendChild(row);
                }
            }
        </script>
    </head>
    <body class="ac">
        <div class="wrapper">
            <div class="content">
                <div id="ac-table-paging" class="ac-table-paging">

                </div>
                <div id="ac-table-head" class="ac-table-head">
                    <div class="column">번호</div>
                    <div class="column">상품명</div>
                    <div class="column">크리에이터</div>
                    <div class="column">상태</div>
                    <div class="column">제조사</div>
                    <div class="column">관리</div>
                </div>
                <div id="ac-table" class="ac-table">

                </div>
            </div>
            <div class="nav reduction">
                <div class="nav-head">
                    <div class="nav-head-expander">
                        <i class="material-icons">
                            first_page
                        </i>
                    </div>
                    <div class="nav-head-logo">
                        Auto Cropper
                    </div>
                </div>
                <div class="nav-body">
                    <div class="nav-body-menu">
                        <div class="menu-item" data-page="edit">
                            <i class="material-icons">
                                crop_free
                            </i>
                            edit
                        </div>
                        <div class="menu-item" data-page="auto">
                            <i class="material-icons">
                                style
                            </i>
                            auto
                        </div>
                        <div class="menu-item" data-page="creator">
                            <i class="material-icons">
                                people
                            </i>
                            creator
                        </div>
                        <div class="menu-item" data-page="maker">
                            <i class="material-icons">
                                build
                            </i>
                            maker
                        </div>
                        <div class="menu-item" data-page="package">
                            <i class="material-icons">
                                how_to_vote
                            </i>
                            package
                        </div>
                        <div class="menu-item active" data-page="product">
                            <i class="material-icons">
                                local_mall
                            </i>
                            product
                        </div>
                    </div>
                    <div class="nav-body-content">

                    </div>
                </div>
            </div>
        </div>
    </body>
</html>